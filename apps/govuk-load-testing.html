
<!doctype html>
<html lang="en" class="govuk-template no-js">
  <head>
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">

    <title>Application: govuk-load-testing - GOV.UK Developer Documentation</title>

    <link href="/stylesheets/manifest.css" rel="stylesheet" />

    <link rel="canonical" href="https://docs.publishing.service.gov.uk/apps/govuk-load-testing.html">

      <meta name="description" content="Everything about the govuk-load-testing application (Test plans for load testing GOV.UK apps using Gatling.)" />
      <meta name="twitter:card" content="summary" />
      <meta name="twitter:domain" content="docs.publishing.service.gov.uk" />
      <meta name="twitter:image" content="https://docs.publishing.service.gov.uk/images/govuk-large.png" />
      <meta name="twitter:title" content="Application: govuk-load-testing - GOV.UK Developer Documentation" />
      <meta name="twitter:url" content="https://docs.publishing.service.gov.uk/apps/govuk-load-testing.html" />

      <meta property="og:description" content="Everything about the govuk-load-testing application (Test plans for load testing GOV.UK apps using Gatling.)" />
      <meta property="og:image" content="https://docs.publishing.service.gov.uk/images/govuk-large.png" />
      <meta property="og:site_name" content="GOV.UK Developer Documentation" />
      <meta property="og:title" content="Application: govuk-load-testing" />
      <meta property="og:type" content="object" />
      <meta property="og:url" content="https://docs.publishing.service.gov.uk/apps/govuk-load-testing.html" />

    
  </head>

  <body class="govuk-template__body">
    <script>document.body.className = ((document.body.className) ? document.body.className + ' js-enabled' : 'js-enabled');</script>

    <div class="app-pane">
      <div class="app-pane__header toc-open-disabled">
        <a href="#content" class="govuk-skip-link">Skip to main content</a>

        <header class="govuk-header app-header" role="banner" data-module="govuk-header">
  <div class="govuk-header__container govuk-header__container--full-width">
    <div class="govuk-header__logo">
      <a href="/" class="govuk-header__link govuk-header__link--homepage">
        <span class="govuk-header__logotype">
          <svg
            aria-hidden="true"
            focusable="false"
            class="govuk-header__logotype-crown"
            xmlns="http://www.w3.org/2000/svg"
            viewbox="0 0 132 97"
            height="30"
            width="36"
          >
            <path
              fill="currentColor" fill-rule="evenodd"
              d="M25 30.2c3.5 1.5 7.7-.2 9.1-3.7 1.5-3.6-.2-7.8-3.9-9.2-3.6-1.4-7.6.3-9.1 3.9-1.4 3.5.3 7.5 3.9 9zM9 39.5c3.6 1.5 7.8-.2 9.2-3.7 1.5-3.6-.2-7.8-3.9-9.1-3.6-1.5-7.6.2-9.1 3.8-1.4 3.5.3 7.5 3.8 9zM4.4 57.2c3.5 1.5 7.7-.2 9.1-3.8 1.5-3.6-.2-7.7-3.9-9.1-3.5-1.5-7.6.3-9.1 3.8-1.4 3.5.3 7.6 3.9 9.1zm38.3-21.4c3.5 1.5 7.7-.2 9.1-3.8 1.5-3.6-.2-7.7-3.9-9.1-3.6-1.5-7.6.3-9.1 3.8-1.3 3.6.4 7.7 3.9 9.1zm64.4-5.6c-3.6 1.5-7.8-.2-9.1-3.7-1.5-3.6.2-7.8 3.8-9.2 3.6-1.4 7.7.3 9.2 3.9 1.3 3.5-.4 7.5-3.9 9zm15.9 9.3c-3.6 1.5-7.7-.2-9.1-3.7-1.5-3.6.2-7.8 3.7-9.1 3.6-1.5 7.7.2 9.2 3.8 1.5 3.5-.3 7.5-3.8 9zm4.7 17.7c-3.6 1.5-7.8-.2-9.2-3.8-1.5-3.6.2-7.7 3.9-9.1 3.6-1.5 7.7.3 9.2 3.8 1.3 3.5-.4 7.6-3.9 9.1zM89.3 35.8c-3.6 1.5-7.8-.2-9.2-3.8-1.4-3.6.2-7.7 3.9-9.1 3.6-1.5 7.7.3 9.2 3.8 1.4 3.6-.3 7.7-3.9 9.1zM69.7 17.7l8.9 4.7V9.3l-8.9 2.8c-.2-.3-.5-.6-.9-.9L72.4 0H59.6l3.5 11.2c-.3.3-.6.5-.9.9l-8.8-2.8v13.1l8.8-4.7c.3.3.6.7.9.9l-5 15.4v.1c-.2.8-.4 1.6-.4 2.4 0 4.1 3.1 7.5 7 8.1h.2c.3 0 .7.1 1 .1.4 0 .7 0 1-.1h.2c4-.6 7.1-4.1 7.1-8.1 0-.8-.1-1.7-.4-2.4V34l-5.1-15.4c.4-.2.7-.6 1-.9zM66 92.8c16.9 0 32.8 1.1 47.1 3.2 4-16.9 8.9-26.7 14-33.5l-9.6-3.4c1 4.9 1.1 7.2 0 10.2-1.5-1.4-3-4.3-4.2-8.7L108.6 76c2.8-2 5-3.2 7.5-3.3-4.4 9.4-10 11.9-13.6 11.2-4.3-.8-6.3-4.6-5.6-7.9 1-4.7 5.7-5.9 8-.5 4.3-8.7-3-11.4-7.6-8.8 7.1-7.2 7.9-13.5 2.1-21.1-8 6.1-8.1 12.3-4.5 20.8-4.7-5.4-12.1-2.5-9.5 6.2 3.4-5.2 7.9-2 7.2 3.1-.6 4.3-6.4 7.8-13.5 7.2-10.3-.9-10.9-8-11.2-13.8 2.5-.5 7.1 1.8 11 7.3L80.2 60c-4.1 4.4-8 5.3-12.3 5.4 1.4-4.4 8-11.6 8-11.6H55.5s6.4 7.2 7.9 11.6c-4.2-.1-8-1-12.3-5.4l1.4 16.4c3.9-5.5 8.5-7.7 10.9-7.3-.3 5.8-.9 12.8-11.1 13.8-7.2.6-12.9-2.9-13.5-7.2-.7-5 3.8-8.3 7.1-3.1 2.7-8.7-4.6-11.6-9.4-6.2 3.7-8.5 3.6-14.7-4.6-20.8-5.8 7.6-5 13.9 2.2 21.1-4.7-2.6-11.9.1-7.7 8.8 2.3-5.5 7.1-4.2 8.1.5.7 3.3-1.3 7.1-5.7 7.9-3.5.7-9-1.8-13.5-11.2 2.5.1 4.7 1.3 7.5 3.3l-4.7-15.4c-1.2 4.4-2.7 7.2-4.3 8.7-1.1-3-.9-5.3 0-10.2l-9.5 3.4c5 6.9 9.9 16.7 14 33.5 14.8-2.1 30.8-3.2 47.7-3.2z"
            ></path>
            <image src="/assets/images/govuk-logotype-crown.png" xlink:href="" class="govuk-header__logotype-crown-fallback-image" width="36" height="32"></image>
          </svg>
          <span class="govuk-header__logotype-text">
            GOV.UK
          </span>
        </span>
        <span class="govuk-header__product-name">
          Developer docs
        </span>
      </a>
    </div>
    <div class="govuk-header__content">
      <button type="button" class="govuk-header__menu-button govuk-js-header-toggle" aria-controls="navigation" aria-label="Show or hide Top Level Navigation">Menu</button>
      <nav>
        <ul id="navigation" class="govuk-header__navigation govuk-header__navigation--end" aria-label="Top Level Navigation">
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/">Dashboard</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/manual/get-started.html">Get started</a>
            </li>
            <li class="govuk-header__navigation-item govuk-header__navigation-item--active">
              <a class="govuk-header__link" href="/apps.html">Apps</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/manual.html">Manual</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/content-schemas.html">Schemas</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/document-types.html">Document types</a>
            </li>
        </ul>
      </nav>
    </div>
  </div>
</header>

      </div>

        <div id="toc-heading" class="toc-show fixedsticky">
          <a href="#toc" class="toc-show__label js-toc-show" aria-controls="toc">
            Table of contents <span class="toc-show__icon"></span>
          </a>
        </div>

      <div class="app-pane__body">
          <div class="app-pane__toc">
            <div class="toc" data-module="table-of-contents">
              <div class="search" data-module="search">
  <form action="https://www.google.co.uk/search" method="get" role="search">
    <input type="hidden" name="as_sitesearch" value="https://docs.publishing.service.gov.uk"/>
    <label class="govuk-label search__label" for="search">
      Search (via Google)
    </label>
    <input class="govuk-input govuk-!-margin-bottom-4" id="search" name="q" type="text" aria-controls="search-results" placeholder="Search">
  </form>
  <div id="search-results" class="search-results" aria-hidden="true" role="dialog" aria-labelledby="search-results-title">
    <div class="search-results__inner">
      <button class="search-results__close">Close<span class="search-results__close-label"> search results</span></button>
      <h2 id="search-results-title" class="search-results__title" aria-live="polite">Results</h2>
      <div class="search-results__content"></div>
    </div>
  </div>
</div>

              <a href="#" class="toc__close js-toc-close" aria-controls="toc" aria-label="Hide table of contents"></a>
              <nav id="toc" class="js-toc-list toc__list" aria-labelledby="toc-heading">
                  <ul>
    <li>
      <a href="/apps/by-team.html">
        <span>Application ownership by team</span>
      </a>
    </li>

      <li>
        <a href="/apps.html">
          <span>APIs</span>
        </a>
      </li>
      <li>
        <ul class='subnav'>
          <li><a href="/apps/asset-manager.html"><span>asset-manager</span></a></li>
          <li><a href="/apps/content-store.html"><span>content-store</span></a></li>
          <li><a href="/apps/email-alert-api.html"><span>email-alert-api</span></a></li>
          <li><a href="/apps/hmrc-manuals-api.html"><span>hmrc-manuals-api</span></a></li>
          <li><a href="/apps/imminence.html"><span>imminence</span></a></li>
          <li><a href="/apps/link-checker-api.html"><span>link-checker-api</span></a></li>
          <li><a href="/apps/mapit.html"><span>mapit</span></a></li>
          <li><a href="/apps/publishing-api.html"><span>publishing-api</span></a></li>
          <li><a href="/apps/router-api.html"><span>router-api</span></a></li>
          <li><a href="/apps/search-api.html"><span>search-api</span></a></li>
          <li><a href="/apps/support-api.html"><span>support-api</span></a></li>
        </ul>
      </li>
      <li>
        <a href="/apps.html">
          <span>Supporting apps</span>
        </a>
      </li>
      <li>
        <ul class='subnav'>
          <li><a href="/apps/authenticating-proxy.html"><span>authenticating-proxy</span></a></li>
          <li><a href="/apps/content-data-admin.html"><span>content-data-admin</span></a></li>
          <li><a href="/apps/content-data-api.html"><span>content-data-api</span></a></li>
          <li><a href="/apps/govuk-load-testing.html" class="toc-link--in-view"><span>govuk-load-testing</span></a></li>
          <li><a href="/apps/release.html"><span>release</span></a></li>
          <li><a href="/apps/router.html"><span>router</span></a></li>
          <li><a href="/apps/search-admin.html"><span>search-admin</span></a></li>
          <li><a href="/apps/signon.html"><span>signon</span></a></li>
          <li><a href="/apps/support.html"><span>support</span></a></li>
        </ul>
      </li>
      <li>
        <a href="/apps.html">
          <span>Transition apps</span>
        </a>
      </li>
      <li>
        <ul class='subnav'>
          <li><a href="/apps/bouncer.html"><span>bouncer</span></a></li>
          <li><a href="/apps/side-by-side-browser.html"><span>side-by-side-browser</span></a></li>
          <li><a href="/apps/transition.html"><span>transition</span></a></li>
        </ul>
      </li>
      <li>
        <a href="/apps.html">
          <span>Services</span>
        </a>
      </li>
      <li>
        <ul class='subnav'>
          <li><a href="/apps/cache-clearing-service.html"><span>cache-clearing-service</span></a></li>
          <li><a href="/apps/email-alert-service.html"><span>email-alert-service</span></a></li>
          <li><a href="/apps/search-analytics.html"><span>search-analytics</span></a></li>
        </ul>
      </li>
      <li>
        <a href="/apps.html">
          <span>Frontend apps</span>
        </a>
      </li>
      <li>
        <ul class='subnav'>
          <li><a href="/apps/calculators.html"><span>calculators</span></a></li>
          <li><a href="/apps/collections.html"><span>collections</span></a></li>
          <li><a href="/apps/email-alert-frontend.html"><span>email-alert-frontend</span></a></li>
          <li><a href="/apps/feedback.html"><span>feedback</span></a></li>
          <li><a href="/apps/finder-frontend.html"><span>finder-frontend</span></a></li>
          <li><a href="/apps/frontend.html"><span>frontend</span></a></li>
          <li><a href="/apps/government-frontend.html"><span>government-frontend</span></a></li>
          <li><a href="/apps/info-frontend.html"><span>info-frontend</span></a></li>
          <li><a href="/apps/licence-finder.html"><span>licence-finder</span></a></li>
          <li><a href="/apps/manuals-frontend.html"><span>manuals-frontend</span></a></li>
          <li><a href="/apps/service-manual-frontend.html"><span>service-manual-frontend</span></a></li>
          <li><a href="/apps/smart-answers.html"><span>smart-answers</span></a></li>
          <li><a href="/apps/static.html"><span>static</span></a></li>
        </ul>
      </li>
      <li>
        <a href="/apps.html">
          <span>data.gov.uk apps</span>
        </a>
      </li>
      <li>
        <ul class='subnav'>
          <li><a href="/apps/ckanext-datagovuk.html"><span>ckanext-datagovuk</span></a></li>
          <li><a href="/apps/datagovuk_find.html"><span>datagovuk_find</span></a></li>
          <li><a href="/apps/datagovuk_publish.html"><span>datagovuk_publish</span></a></li>
          <li><a href="/apps/datagovuk_reference.html"><span>datagovuk_reference</span></a></li>
        </ul>
      </li>
      <li>
        <a href="/apps.html">
          <span>Publishing apps</span>
        </a>
      </li>
      <li>
        <ul class='subnav'>
          <li><a href="/apps/collections-publisher.html"><span>collections-publisher</span></a></li>
          <li><a href="/apps/contacts-admin.html"><span>contacts-admin</span></a></li>
          <li><a href="/apps/content-publisher.html"><span>content-publisher</span></a></li>
          <li><a href="/apps/content-tagger.html"><span>content-tagger</span></a></li>
          <li><a href="/apps/local-links-manager.html"><span>local-links-manager</span></a></li>
          <li><a href="/apps/manuals-publisher.html"><span>manuals-publisher</span></a></li>
          <li><a href="/apps/maslow.html"><span>maslow</span></a></li>
          <li><a href="/apps/publisher.html"><span>publisher</span></a></li>
          <li><a href="/apps/service-manual-publisher.html"><span>service-manual-publisher</span></a></li>
          <li><a href="/apps/short-url-manager.html"><span>short-url-manager</span></a></li>
          <li><a href="/apps/specialist-publisher.html"><span>specialist-publisher</span></a></li>
          <li><a href="/apps/travel-advice-publisher.html"><span>travel-advice-publisher</span></a></li>
          <li><a href="/apps/whitehall.html"><span>whitehall</span></a></li>
        </ul>
      </li>
      <li>
        <a href="/apps.html">
          <span>Utilities</span>
        </a>
      </li>
      <li>
        <ul class='subnav'>
          <li><a href="/apps/govuk-alert-tracker.html"><span>govuk-alert-tracker</span></a></li>
          <li><a href="/apps/govuk-content-store-examples.html"><span>govuk-content-store-examples</span></a></li>
          <li><a href="/apps/govuk-dependencies.html"><span>govuk-dependencies</span></a></li>
          <li><a href="/apps/govuk-display-screen.html"><span>govuk-display-screen</span></a></li>
          <li><a href="/apps/govuk-pact-broker.html"><span>govuk-pact-broker</span></a></li>
          <li><a href="/apps/govuk-puppet.html"><span>govuk-puppet</span></a></li>
          <li><a href="/apps/govuk-secondline-blinken.html"><span>govuk-secondline-blinken</span></a></li>
          <li><a href="/apps/govuk-zendesk-display-screen.html"><span>govuk-zendesk-display-screen</span></a></li>
          <li><a href="/apps/seal.html"><span>seal</span></a></li>
          <li><a href="/apps/search-performance-explorer.html"><span>search-performance-explorer</span></a></li>
          <li><a href="/apps/side-by-side-browser.html"><span>side-by-side-browser</span></a></li>
          <li><a href="/apps/tech-docs-monitor.html"><span>tech-docs-monitor</span></a></li>
        </ul>
      </li>
      <li>
        <a href="/apps.html">
          <span>Data science</span>
        </a>
      </li>
      <li>
        <ul class='subnav'>
          <li><a href="/apps/govuk-knowledge-graph.html"><span>govuk-knowledge-graph</span></a></li>
          <li><a href="/apps/govuk-related-links-recommender.html"><span>govuk-related-links-recommender</span></a></li>
        </ul>
      </li>
      <li>
        <a href="/apps.html">
          <span>Licensing apps</span>
        </a>
      </li>
      <li>
        <ul class='subnav'>
          <li><a href="/apps/licensify.html"><span>licensify</span></a></li>
        </ul>
      </li>
  </ul>

              </nav>
            </div>
          </div>

        <div class="app-pane__content toc-open-disabled">
          <main id="content" class="technical-documentation" data-module="anchored-headings">
              <h1 class="page-title">Application: govuk-load-testing</h1>

  <p>Test plans for load testing GOV.UK apps using Gatling.</p>

<h2 id="hosting">Hosting</h2>

<p>There is no production version of this application yet.</p>

<h2 id="links">Links</h2>

<ul>
  <li><a href="https://github.com/alphagov/govuk-load-testing">GitHub repo</a></li>

    <li><a href="https://sentry.io/govuk/app-govuk-load-testing">Sentry (error tracking)</a></li>



    <li><a href="https://github.com/alphagov/govuk-app-deployment/blob/master/govuk-load-testing/config/deploy.rb">Deploy scripts</a></li>

    <li><a href="https://grafana.publishing.service.gov.uk/dashboard/file/govuk-load-testing.json">Deployment dashboard</a></li>





</ul>

<h2 id="readme">README</h2>

<div class="govuk-warning-text">
    <span class="govuk-warning-text__icon" aria-hidden="true">!</span>
    <strong class="govuk-warning-text__text">
      <span class="govuk-warning-text__assistive">Warning</span>
      The content below is pulled in directly from the repository.<br />
      Links might not function properly.
    </strong>
  </div>

<div class="embedded-readme">
    
<p>Test plans for load testing GOV.UK frontend apps using <a href="https://gatling.io/">Gatling</a>.</p>
<h3 id="table-of-contents">Table of Contents</h3>
<ol>
<li><a href="#terminology">Terminology</a></li>
<li>
<a href="#methods">Methods</a><br />
2.1 <a href="#govuk-gatling">GOV.UK Gatling</a><br />
2.2 <a href="#virtual-machine">Virtual Machine</a><br />
2.3 <a href="#aws-gatling">Rental of an enterprise Gatling Instance via AWS Marketplace</a>
</li>
<li><a href="#configuration">Configuration Options</a></li>
<li><a href="#plans">Simulation Plans</a></li>
<li><a href="#uploading">Uploading</a></li>
<li><a href="#combining">Combining concurrent test results</a></li>
<li><a href="#troubleshooting">Troubleshooting</a></li>
</ol>
<h1 id="1-terminology-">
<!-- raw HTML omitted -->1. Terminology <!-- raw HTML omitted -->
</h1>
<ol>
<li>
<p><code>$GATLING_HOME</code> is the directory where Gatling is installed to. For example, if you download version 3.0.0-RC4 of the Gatling bundle zip and extract it in your <code>~/Downloads</code> folder, <code>$GATLING_HOME</code> is <code>~/Downloads/gatling-charts-highcharts-bundle-3.0.0-RC4</code></p>
</li>
<li>
<p>simulation plan: a set of scenarios, where each scenario represents how a user will interact with the website.</p>
</li>
</ol>
<h1 id="2-methods">
<!-- raw HTML omitted -->2. Methods<!-- raw HTML omitted -->
</h1>
<p>There are 3 main methods to install and run Gatling:</p>
<ol>
<li><a href="#govuk-gatling">terraform a gatling instance using GOV.UK tools and run Gatling</a></li>
<li><a href="#virtual-machine">install and run Gatling on a virtual machine which can reside on your laptop or a AWS instance</a></li>
<li><a href="#aws-gatling">rent an enterprise Gatling instance via AWS Marketplace</a></li>
</ol>
<h2 id="2-1-gov-uk-gatling">
<!-- raw HTML omitted -->2.1 GOV.UK Gatling<!-- raw HTML omitted -->
</h2>
<h3 id="provision-gov-uk-gatling">Provision GOV.UK Gatling</h3>
<p>To provision a Gatling instance, <a href="https://docs.publishing.service.gov.uk/manual/deploying-terraform.html#deploying-with-deploy-rb">deploy
Terraform</a>
for <code>app-gatling</code> in the <code>govuk</code> stack in the required environment.</p>
<h3 id="running-a-plan">Running a Plan</h3>
<ol>
<li>
<p>SSH into the Gatling instance</p>
</li>
<li>
<p>Switch to the <code>gatling</code> user and into the right directory</p>
<pre><code>sudo su - gatling
cd ~/govuk-load-testing
</code></pre>
</li>
<li>
<p>Export the <a href="#configuration">required environment variables</a> for your load test</p>
</li>
<li>
<p>Run Gatling with <code>/usr/local/bin/gatling/bin/gatling.sh -sf src/test/scala</code></p>
</li>
<li>
<p>Learn <a href="#plans">what each simualtion plan tests</a> and choose one:</p>
<pre><code>Choose a simulation number:
    [0] govuk.Frontend
    [1] govuk.WhitehallPublishing
    [2] govuk.WhitehallPublishingCollections
</code></pre>
</li>
<li>
<p>Now, the Gatling web UI is available at
<code>https://gatling.&lt;environment&gt;.govuk.digital</code>. There's an index of
all Gatling runs made since provisioning, and you can see the
results of a particular run.</p>
</li>
</ol>
<h3 id="when-youve-finished">When You've Finished</h3>
<p>Manually "stop" the Gatling instance in the AWS Console UI.</p>
<h2 id="2-2-virtual-machine">
<!-- raw HTML omitted -->2.2 Virtual Machine<!-- raw HTML omitted -->
</h2>
<h3 id="installation-steps">Installation Steps</h3>
<p>The installation steps are:</p>
<ol>
<li>Install a JDK, Gatling needs at least version 8</li>
<li>Clone this repository into your <code>~/govuk/</code> directory</li>
<li>
<a href="https://gatling.io/download/">Download</a> and extract Gatling, these test plans are written for version 3</li>
<li>Rename and move the extracted Gatling directory to <code>~/govuk/gatling</code> to make it available in <code>/var/govuk/gatling</code> in your Virtual Machine</li>
<li>Set the needed environment variables:</li>
</ol>
<ul>
<li>
<p><code>$ export 'JAVA_OPTS=&lt;required-options&gt;'</code> (see <a href="#configuration">Configuration Options</a>)</p>
</li>
<li>
<p><code>$ export 'GATLING_USERNAME=&lt;test-user-email&gt;'</code></p>
</li>
<li>
<p><code>$ export 'GATLING_PASSWORD=&lt;test-user-password&gt;'</code></p>
<p><strong>Note:</strong> <code>GATLING_USERNAME</code> and <code>GATLING_PASSWORD</code> are only needed for test plans using Signon.
These are the credentials for the test user that has been set up in Signon in the environment it's going to test in, e.g. <code>staging</code>.</p>
</li>
</ul>
<h3 id="running-a-plan">Running a Plan</h3>
<p>In order to run a simulation plan, Gatling provides a wrapper script to compile and launch test plans in its <code>user-files</code> directory.</p>
<p>You can run Gatling by:</p>
<ol>
<li>running the following command:</li>
</ol>
<pre><code>$ $GATLING_HOME/bin/gatling.sh -sf src/test/scala
</code></pre>
<p><strong>Note:</strong> This command must be run from within <code>~/govuk/govuk-load-testing</code> (or <code>/var/govuk/govuk-load-testing</code> if you are using the Virtual Machine).</p>
<ol start="2">
<li>selecting the simulation plan number that you wish to run.</li>
</ol>
<pre><code>Choose a simulation number:
    [0] govuk.BusinessReadinessFinder
    [1] govuk.DynamicLists
    [2] govuk.DynamicListsEmailSignup
    [3] govuk.Frontend
    [4] govuk.PublishToPublishingApi
    [5] govuk.WhitehallPublishing
    [6] govuk.WhitehallPublishingCollections
</code></pre>
<p>A description of relevant simulation plans available for the gov.uk website
is available <a href="#plans">here</a></p>
<h2 id="2-3-rental-of-an-enterprise-gatling-instance-via-aws-marketplace">
<!-- raw HTML omitted -->2.3 Rental of an enterprise Gatling Instance via AWS Marketplace<!-- raw HTML omitted -->
</h2>
<p><strong>Note:</strong> Gatling FrontLine instances cost $9/hour, so it's important to switch off the instance while it's not in use.</p>
<h3 id="launching-a-gatling-instance">Launching a Gatling instance</h3>
<p>To launch a Gatling instance, follow the instructions below. You may find there is already an existing Gatling instance available in EC2,  in which case you can just start it without having to create a new one.</p>
<ol>
<li>First make sure you are <a href="https://docs.publishing.service.gov.uk/manual/aws-console-access.html#header">logged in to AWS and have switched your role to production</a>
</li>
<li>Go to "AWS Marketplace Solutions" from the services list (you may need to switch region to N. Virginia).</li>
<li>Select "Manage" on Gatling FrontLine, click on "Actions" and then "Launch new instance."</li>
<li>Set the region to "eu-west-1" and click "Continue to Launch".</li>
<li>Select your desired EC2 Instance Type (recommended <code>t2.2xlarge</code>).</li>
<li>Choose the <code>vpc-07069e8dd026cc725</code> VPC, <code>subnet-00103e6927dd1fb36</code> subnet and <code>govuk_gatling_access</code> security group.</li>
<li>Click "Launch" and you will be given a link to the EC2 instance.</li>
<li>Find the Public DNS name for that instance and go to it in your browser. It should provide you with a wizard to complete the set up of the instance.</li>
<li>You may find it useful to rename the instance in AWS to <code>gatling</code> so you can find it again easily.</li>
<li>If running the test cross-environment (e.g. running a load test in staging from a production EC2 instance), edit the <code>govuk_cache_external_elb_access</code> security group in the environment you are testing to permit access on port 443 from the public IP address of your Gatling EC2 instance.</li>
</ol>
<h4 id="running-a-plan">Running a Plan</h4>
<p>Once you have a Gatling FrontLine EC2 instance, you can use it to load a plan.</p>
<ol>
<li>Click on "Create" at the top left to create your plan.</li>
<li>Give it a name, and choose the classname that corresponds to the test plan class you want. For example, <code>govuk.Frontend</code> for <a href="https://github.com/alphagov/govuk-load-testing/blob/master/src/test/resources/scala/Frontend.scala">Frontend.scala</a>. See this <a href="#plans">section</a> for a list of plans.</li>
<li>Click next and choose "Build from sources" (should be the default option). Enter <code>git clone https://github.com/alphagov/govuk-load-testing.git</code> into the repository command box, choose <code>SBT Project</code> in the build command drop down and click next.</li>
<li>If you're only using this one instance, choose the "Local" pool with a weight of 100%.</li>
<li>Click on "More options" and here you can enter the <code>JAVA_OPTS</code> value in the second box. For example, to use 100 workers, you would enter <code>-Dworkers=100</code>. Please see <a href="#configuration">section</a> for further configuration options.</li>
<li>Now you can click save and your plan should appear in the list. Click the play button to build it.</li>
<li>Once your plan has built, it will go ahead and run it for you. You can click on the icon of a graph to view live updating results from the load test.</li>
</ol>
<h2 id="3-configuration-options">
<!-- raw HTML omitted -->3. Configuration Options<!-- raw HTML omitted -->
</h2>
<p>We use Java properties to pass options to the script which we don't want to hard-code.  These can be set using the <code>JAVA_OPTS</code> environment variable:</p>
<pre><code>$ export JAVA_OPTS="-Dkey1=value1 -Dkey2=value2 ..."
</code></pre>
<p>The following property is required:</p>
<ul>
<li>
<code>baseUrl</code>, prepended to all requests, at the least it should include the scheme and domain name</li>
</ul>
<p>The following properties are necessary depending on the environment or scenario:</p>
<ul>
<li>
<code>username</code>, the HTTP basic auth username</li>
<li>
<code>password</code>, the HTTP basic auth password</li>
</ul>
<p>The property <code>signonUrl</code> and environment variables <code>GATLING_USERNAME</code> and <code>GATLING_PASSWORD</code> are required for scenarios authenticating with a signon application.</p>
<p>The following properties are optional:</p>
<ul>
<li>
<code>dataDir</code> (default: "src/test/resources/test-data"), the directory to look in for test data files</li>
<li>
<code>rateLimitToken</code> (default: no header sent), the value of the <code>Rate-Limit-Token</code> header</li>
<li>
<code>workers</code> (default: 1), the number of threads making requests</li>
<li>
<code>ramp</code> (default: 0), the duration, in seconds, over which the workers are started</li>
<li>
<code>bust</code> (default: false), whether to pass a unique cache-busting string with every request or not</li>
<li>
<code>maxTime</code> (default: 3600), the longest a test can run, defaulted to 1 hour</li>
</ul>
<h2 id="4-simulation-plans-">
<!-- raw HTML omitted -->4. Simulation Plans <!-- raw HTML omitted -->
</h2>
<p>The simulation plans for gov.uk are located in the <code>src/test/scala</code> directory of this repository
while their data files live in the <code>src/test/resources</code> directory.</p>
<ol>
<li>
<p><strong>govuk.BusinessReadinessFinder</strong></p>
<p><strong>Data files:</strong> business-readiness-paths.csv</p>
<p><strong>Optional:</strong> <code>factor</code> (default: 1), the multiplier to apply to the amount of desired traffic
For an entry <code>base_path,hits</code>, each worker requests <code>base_path</code> <code>ceil(hits * factor / workers)</code> times, with no delay between requests.  Each worker proceeds through the csv in order.</p>
<p><strong>Optional:</strong> <code>duration</code> (default: 0), if set the test will last for the given number of seconds. Any workers that have not started or completed will be halted at this point. Conversely, any workers that finish ahead of this point will be restarted to ensure the test lasts for the given time.</p>
</li>
<li>
<p><strong>govuk.DynamicLists</strong></p>
<p><strong>Data files:</strong> get-ready-brexit-check_paths.csv</p>
<p><strong>Optional:</strong> <code>factor</code> (default: 1), the multiplier to apply to the amount of desired traffic
For an entry <code>base_path,hits</code>, each worker requests <code>base_path</code> <code>ceil(hits * factor / workers)</code> times, with no delay between requests.  Each worker proceeds through the csv in order.</p>
<p><strong>Optional:</strong> <code>duration</code> (default: 0), if set the test will last for the given number of seconds. Any workers that have not started or completed will be halted at this point. Conversely, any workers that finish ahead of this point will be restarted to ensure the test lasts for the given time.</p>
</li>
<li>
<p><strong>govuk.DynamicListsEmailSignup</strong></p>
<p><strong>Data files:</strong> get-ready-brexit-check-email-signup_paths.csv</p>
<p><strong>Optional:</strong> <code>factor</code> (default: 1), the multiplier to apply to the amount of desired traffic
For an entry <code>base_path,hits</code>, each worker requests <code>base_path</code> <code>ceil(hits * factor / workers)</code> times, with no delay between requests.  Each worker proceeds through the csv in order.</p>
<p><strong>Optional:</strong> <code>duration</code> (default: 0), if set the test will last for the given number of seconds. Any workers that have not started or completed will be halted at this point. Conversely, any workers that finish ahead of this point will be restarted to ensure the test lasts for the given time.</p>
</li>
<li>
<p><strong>govuk.Frontend</strong></p>
<p><strong>Data files:</strong> paths.csv</p>
<p><strong>Optional:</strong> <code>factor</code> (default: 1), the multiplier to apply to the amount of desired traffic
For an entry <code>base_path,hits</code>, each worker requests <code>base_path</code> <code>ceil(hits * factor / workers)</code> times, with no delay between requests.  Each worker proceeds through the csv in order.</p>
<p><strong>Optional:</strong> <code>duration</code> (default: 0), if set the test will last for the given number of seconds. Any workers that have not started or completed will be halted at this point. Conversely, any workers that finish ahead of this point will be restarted to ensure the test lasts for the given time.</p>
<p>If you are having difficulty running the entire test plan on a single machine within your desired duration, try splitting up the data file and running multiple instances of Gatling simultaneously on different machines.</p>
</li>
<li>
<p><strong>govuk.PublishToPublishingApi</strong></p>
<p><strong>Requires:</strong> <code>BEARER_TOKEN</code> environment variables.</p>
<p><strong>Note:</strong> The Publishing API is not accessible from the outside, you'll
need to set up a proxy into our infrastructure to connect to it from
Gatling.</p>
<p>For example, for staging:</p>
<pre lang="sh"><code>$ ssh publishing-api-1.staging -CNL 8443:publishing-api.staging.publishing.service.gov.uk:443
</code></pre>
<p>You'll then need to add the line
<code>127.0.0.1 publishing-api.staging.publishing.service.gov.uk</code> to
<code>/etc/hosts</code> to make sure the HTTPS server name matches.</p>
<p>Then you can set your <code>baseUrl</code> to
<code>https://publishing-api.staging.publishing.service.gov.uk:8443</code>.</p>
<p>Since the load testing is now limited by your SSH proxy, you may want to
increase the <code>ulimit</code> to a high number such as <code>ulimit -n 4096</code>. This means
SSH is able to cope with more open sockets.</p>
<p>Steps:</p>
<ul>
<li>Put content</li>
<li>Patch links</li>
<li>Publish</li>
</ul>
</li>
<li>
<p><strong>govuk.WhitehallPublishing</strong></p>
<p><strong>Requires:</strong> <code>signonUrl</code> property. <code>GATLING_USERNAME</code> and <code>GATLING_PASSWORD</code> environment variables.</p>
<p><strong>Optional:</strong> <code>schedule</code> property will schedule publication.<br />
This value must be a timestamp in the format <code>yyyy-MM-ddTHH:mm</code> (eg. <code>2019-01-10T17:30</code>).
The value must be at least 15 minutes before the test run as Whitehall enforces this rule for scheduled publishing.</p>
<p><strong>Optional:</strong> <code>maxTryAttempt</code> property will set how many times each step will be attempting before logging as a failure.
This is to stimulate a user refreshing or reattempting after receiving an error response.
If nothing is passed, it will default to 1.</p>
<p>Example:</p>
<pre><code>$ export JAVA_OPTS="-DbaseUrl=https://whitehall-admin.staging.publishing.service.gov.uk/ -Dworkers=1 -DsignonUrl=https://signon.staging.publishing.service.gov.uk/"
</code></pre>
<p>Steps:</p>
<ul>
<li>Authenticates with signon</li>
<li>Drafts a publication</li>
<li>Attaches an HTML attachment</li>
<li>Tags to taxonomy</li>
<li>Force publishes or force schedules</li>
</ul>
</li>
<li>
<p><strong>govuk.WhitehallPublishingCollections</strong></p>
<p><strong>Requires:</strong> <code>signonUrl</code> property. <code>GATLING_USERNAME</code> and <code>GATLING_PASSWORD</code> environment variables.</p>
<p><strong>Optional:</strong> <code>documentSearches</code> property - How many document searches to make when adding to the collection.</p>
<p>Steps:</p>
<ul>
<li>Authenticates with signon</li>
<li>Drafts a collection</li>
<li>Searches for Gatling Test publications</li>
<li>Adds search results to collection</li>
<li>Tags to taxonomy</li>
<li>Force publishes</li>
</ul>
</li>
<li>
<p><strong>govuk.Search</strong></p>
<p><strong>Data files:</strong> search.csv</p>
<p><strong>Optional:</strong> <code>factor</code> (default: 1), the multiplier to apply to the amount of desired traffic
For an entry <code>base_path,hits</code>, each worker requests <code>base_path</code> <code>ceil(hits * factor / workers)</code> times, with no delay between requests.  Each worker proceeds through the csv in order.</p>
<p><strong>Optional:</strong> <code>duration</code> (default: 0), if set the test will last for the given number of seconds. Any workers that have not started or completed will be halted at this point. Conversely, any workers that finish ahead of this point will be restarted to ensure the test lasts for the given time.</p>
<p>If you are having difficulty running the entire test plan on a single machine within your desired duration, try splitting up the data file and running multiple instances of Gatling simultaneously on different machines.</p>
</li>
</ol>
<h2 id="5-uploading">
<!-- raw HTML omitted -->5. Uploading<!-- raw HTML omitted -->
</h2>
<p>See <a href="/apps/govuk-load-testing/uploading.html">how to upload results</a> for more information on how to
upload results so they are easy to access in the future.</p>
<h2 id="6-combining-concurrent-test-results">
<!-- raw HTML omitted -->6. Combining concurrent test results<!-- raw HTML omitted -->
</h2>
<p>It may be useful to run multiple concurrent Gatling tests to simulate more load than a single Gatling instance could generate. See <a href="/apps/govuk-load-testing/combining_concurrent_test_results.html">how to combine results from concurrent tests</a>.</p>
<h2 id="7-troubleshooting">
<!-- raw HTML omitted -->7. Troubleshooting<!-- raw HTML omitted -->
</h2>
<ol>
<li>
<p><strong>My requests are being rate limited</strong></p>
<p>Set the <code>rateLimitToken</code> property, and make sure the token is valid for the environment you're testing.  These tokens live in the encrypted hieradata in <a href="https://github.com/alphagov/govuk-secrets">govuk-secrets</a>.</p>
</li>
<li>
<p><strong>Authentication issues</strong></p>
<ul>
<li>Ensure the right permissions have been set for your test user</li>
<li>Disable 2FA</li>
<li>
<code>GATLING_USERNAME</code> needs to be an email address</li>
</ul>
</li>
<li>
<p><strong>No such file or directory</strong></p>
<p>If you see an error such as:</p>
<pre><code>15:16:48.524 [ERROR] i.g.a.Gatling$ - Run crashed
java.io.FileNotFoundException: test-data/lorem-ipsum.txt (No such file or directory)
</code></pre>
<p>Ensure you run gatling in this repo, <code>govuk-load-testing</code>:</p>
<pre><code>export GATLING_HOME=/Users/username/gatling/
$GATLING_HOME/bin/gatling.sh
</code></pre>
</li>
<li>
<p><strong>Exit scenario</strong></p>
<p>This may be useful to remove workers that fail at any step:</p>
<pre><code>.exec{
  //CODE
}.exitHereIfFailed
</code></pre>
</li>
<li>
<p><strong>Output html</strong></p>
<pre><code>.exec(session =&gt; {
  val response = session("BODY").as[String]
  println(s"Response body: \n$response")
  session
})
</code></pre>
</li>
</ol>
  </div>



            
          </main>

          <aside>
              <ul class="contribution-banner">
                <li><a href="https://github.com/alphagov/govuk-developer-docs/blob/master/data/applications.yml">View source</a></li>
                <li><a href="https://github.com/alphagov/govuk-developer-docs/issues/new?labels=bug&amp;title=Re:%20''&amp;body=Problem%20with%20''%20(https://docs.publishing.service.gov.uk/apps/govuk-load-testing.html)">Report problem</a></li>
                <li><a href="https://github.com/alphagov/govuk-developer-docs">GitHub Repo</a></li>
              </ul>
          </aside>

          <footer class="govuk-footer app-footer" role="contentinfo">
  <div class="govuk-footer__meta">
    <div class="govuk-footer__meta-item govuk-footer__meta-item--grow">

        <ul class="govuk-footer__inline-list">
            <li class="govuk-footer__inline-list-item">
              <a class="govuk-footer__link" href="/accessibility.html">Accessibility</a>
            </li>
        </ul>

      <svg
        aria-hidden="true"
        focusable="false"
        class="govuk-footer__licence-logo"
        xmlns="http://www.w3.org/2000/svg"
        viewbox="0 0 483.2 195.7"
        height="17"
        width="41"
      >
        <path
          fill="currentColor"
          d="M421.5 142.8V.1l-50.7 32.3v161.1h112.4v-50.7zm-122.3-9.6A47.12 47.12 0 0 1 221 97.8c0-26 21.1-47.1 47.1-47.1 16.7 0 31.4 8.7 39.7 21.8l42.7-27.2A97.63 97.63 0 0 0 268.1 0c-36.5 0-68.3 20.1-85.1 49.7A98 98 0 0 0 97.8 0C43.9 0 0 43.9 0 97.8s43.9 97.8 97.8 97.8c36.5 0 68.3-20.1 85.1-49.7a97.76 97.76 0 0 0 149.6 25.4l19.4 22.2h3v-87.8h-80l24.3 27.5zM97.8 145c-26 0-47.1-21.1-47.1-47.1s21.1-47.1 47.1-47.1 47.2 21 47.2 47S123.8 145 97.8 145"
        />
      </svg>
      <span class="govuk-footer__licence-description">
        All content is available under the
        <a
          class="govuk-footer__link"
          href="https://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/"
          rel="license"
        >Open Government Licence v3.0</a>, except where otherwise stated
      </span>
    </div>
    <div class="govuk-footer__meta-item">
      <a
        class="govuk-footer__link govuk-footer__copyright-logo"
        href="https://www.nationalarchives.gov.uk/information-management/re-using-public-sector-information/uk-government-licensing-framework/crown-copyright/"
      >Â© Crown copyright</a>
    </div>
  </div>
</footer>

        </div>
      </div>
    </div>

    
    <script src="/javascripts/application.js"></script>
  </body>
</html>
