




<!doctype html>
<html lang="en" class="govuk-template no-js">
  <head>
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">

    <title>Environment data sync - GOV.UK Developer Documentation</title>

    <link href="/stylesheets/manifest.css" rel="stylesheet" />

    <link rel="canonical" href="https://docs.publishing.service.gov.uk/manual/govuk-env-sync.html">

      <meta name="twitter:card" content="summary" />
      <meta name="twitter:domain" content="docs.publishing.service.gov.uk" />
      <meta name="twitter:image" content="https://docs.publishing.service.gov.uk/images/govuk-large.png" />
      <meta name="twitter:title" content="Environment data sync - GOV.UK Developer Documentation" />
      <meta name="twitter:url" content="https://docs.publishing.service.gov.uk/manual/govuk-env-sync.html" />

      <meta property="og:image" content="https://docs.publishing.service.gov.uk/images/govuk-large.png" />
      <meta property="og:site_name" content="GOV.UK Developer Documentation" />
      <meta property="og:title" content="Environment data sync" />
      <meta property="og:type" content="object" />
      <meta property="og:url" content="https://docs.publishing.service.gov.uk/manual/govuk-env-sync.html" />

    
  </head>

  <body class="govuk-template__body">
    <script>document.body.className = ((document.body.className) ? document.body.className + ' js-enabled' : 'js-enabled');</script>

    <div class="app-pane">
      <div class="app-pane__header toc-open-disabled">
        <a href="#content" class="govuk-skip-link">Skip to main content</a>

        <header class="govuk-header app-header" role="banner" data-module="govuk-header">
  <div class="govuk-header__container govuk-header__container--full-width">
    <div class="govuk-header__logo">
      <a href="/" class="govuk-header__link govuk-header__link--homepage">
        <span class="govuk-header__logotype">
          <svg
            aria-hidden="true"
            focusable="false"
            class="govuk-header__logotype-crown"
            xmlns="http://www.w3.org/2000/svg"
            viewbox="0 0 132 97"
            height="30"
            width="36"
          >
            <path
              fill="currentColor" fill-rule="evenodd"
              d="M25 30.2c3.5 1.5 7.7-.2 9.1-3.7 1.5-3.6-.2-7.8-3.9-9.2-3.6-1.4-7.6.3-9.1 3.9-1.4 3.5.3 7.5 3.9 9zM9 39.5c3.6 1.5 7.8-.2 9.2-3.7 1.5-3.6-.2-7.8-3.9-9.1-3.6-1.5-7.6.2-9.1 3.8-1.4 3.5.3 7.5 3.8 9zM4.4 57.2c3.5 1.5 7.7-.2 9.1-3.8 1.5-3.6-.2-7.7-3.9-9.1-3.5-1.5-7.6.3-9.1 3.8-1.4 3.5.3 7.6 3.9 9.1zm38.3-21.4c3.5 1.5 7.7-.2 9.1-3.8 1.5-3.6-.2-7.7-3.9-9.1-3.6-1.5-7.6.3-9.1 3.8-1.3 3.6.4 7.7 3.9 9.1zm64.4-5.6c-3.6 1.5-7.8-.2-9.1-3.7-1.5-3.6.2-7.8 3.8-9.2 3.6-1.4 7.7.3 9.2 3.9 1.3 3.5-.4 7.5-3.9 9zm15.9 9.3c-3.6 1.5-7.7-.2-9.1-3.7-1.5-3.6.2-7.8 3.7-9.1 3.6-1.5 7.7.2 9.2 3.8 1.5 3.5-.3 7.5-3.8 9zm4.7 17.7c-3.6 1.5-7.8-.2-9.2-3.8-1.5-3.6.2-7.7 3.9-9.1 3.6-1.5 7.7.3 9.2 3.8 1.3 3.5-.4 7.6-3.9 9.1zM89.3 35.8c-3.6 1.5-7.8-.2-9.2-3.8-1.4-3.6.2-7.7 3.9-9.1 3.6-1.5 7.7.3 9.2 3.8 1.4 3.6-.3 7.7-3.9 9.1zM69.7 17.7l8.9 4.7V9.3l-8.9 2.8c-.2-.3-.5-.6-.9-.9L72.4 0H59.6l3.5 11.2c-.3.3-.6.5-.9.9l-8.8-2.8v13.1l8.8-4.7c.3.3.6.7.9.9l-5 15.4v.1c-.2.8-.4 1.6-.4 2.4 0 4.1 3.1 7.5 7 8.1h.2c.3 0 .7.1 1 .1.4 0 .7 0 1-.1h.2c4-.6 7.1-4.1 7.1-8.1 0-.8-.1-1.7-.4-2.4V34l-5.1-15.4c.4-.2.7-.6 1-.9zM66 92.8c16.9 0 32.8 1.1 47.1 3.2 4-16.9 8.9-26.7 14-33.5l-9.6-3.4c1 4.9 1.1 7.2 0 10.2-1.5-1.4-3-4.3-4.2-8.7L108.6 76c2.8-2 5-3.2 7.5-3.3-4.4 9.4-10 11.9-13.6 11.2-4.3-.8-6.3-4.6-5.6-7.9 1-4.7 5.7-5.9 8-.5 4.3-8.7-3-11.4-7.6-8.8 7.1-7.2 7.9-13.5 2.1-21.1-8 6.1-8.1 12.3-4.5 20.8-4.7-5.4-12.1-2.5-9.5 6.2 3.4-5.2 7.9-2 7.2 3.1-.6 4.3-6.4 7.8-13.5 7.2-10.3-.9-10.9-8-11.2-13.8 2.5-.5 7.1 1.8 11 7.3L80.2 60c-4.1 4.4-8 5.3-12.3 5.4 1.4-4.4 8-11.6 8-11.6H55.5s6.4 7.2 7.9 11.6c-4.2-.1-8-1-12.3-5.4l1.4 16.4c3.9-5.5 8.5-7.7 10.9-7.3-.3 5.8-.9 12.8-11.1 13.8-7.2.6-12.9-2.9-13.5-7.2-.7-5 3.8-8.3 7.1-3.1 2.7-8.7-4.6-11.6-9.4-6.2 3.7-8.5 3.6-14.7-4.6-20.8-5.8 7.6-5 13.9 2.2 21.1-4.7-2.6-11.9.1-7.7 8.8 2.3-5.5 7.1-4.2 8.1.5.7 3.3-1.3 7.1-5.7 7.9-3.5.7-9-1.8-13.5-11.2 2.5.1 4.7 1.3 7.5 3.3l-4.7-15.4c-1.2 4.4-2.7 7.2-4.3 8.7-1.1-3-.9-5.3 0-10.2l-9.5 3.4c5 6.9 9.9 16.7 14 33.5 14.8-2.1 30.8-3.2 47.7-3.2z"
            ></path>
            <image src="/assets/images/govuk-logotype-crown.png" xlink:href="" class="govuk-header__logotype-crown-fallback-image" width="36" height="32"></image>
          </svg>
          <span class="govuk-header__logotype-text">
            GOV.UK
          </span>
        </span>
        <span class="govuk-header__product-name">
          Developer docs
        </span>
      </a>
    </div>
    <div class="govuk-header__content">
      <button type="button" class="govuk-header__menu-button govuk-js-header-toggle" aria-controls="navigation" aria-label="Show or hide Top Level Navigation">Menu</button>
      <nav>
        <ul id="navigation" class="govuk-header__navigation govuk-header__navigation--end" aria-label="Top Level Navigation">
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/">Dashboard</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/manual/get-started.html">Get started</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/apps.html">Apps</a>
            </li>
            <li class="govuk-header__navigation-item govuk-header__navigation-item--active">
              <a class="govuk-header__link" href="/manual.html">Manual</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/content-schemas.html">Schemas</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/document-types.html">Document types</a>
            </li>
        </ul>
      </nav>
    </div>
  </div>
</header>

      </div>

        <div id="toc-heading" class="toc-show fixedsticky">
          <a href="#toc" class="toc-show__label js-toc-show" aria-controls="toc">
            Table of contents <span class="toc-show__icon"></span>
          </a>
        </div>

      <div class="app-pane__body">
          <div class="app-pane__toc">
            <div class="toc" data-module="table-of-contents">
              <div class="search" data-module="search">
  <form action="https://www.google.co.uk/search" method="get" role="search">
    <input type="hidden" name="as_sitesearch" value="https://docs.publishing.service.gov.uk"/>
    <label class="govuk-label search__label" for="search">
      Search (via Google)
    </label>
    <input class="govuk-input govuk-!-margin-bottom-4" id="search" name="q" type="text" aria-controls="search-results" placeholder="Search">
  </form>
  <div id="search-results" class="search-results" aria-hidden="true" role="dialog" aria-labelledby="search-results-title">
    <div class="search-results__inner">
      <button class="search-results__close">Close<span class="search-results__close-label"> search results</span></button>
      <h2 id="search-results-title" class="search-results__title" aria-live="polite">Results</h2>
      <div class="search-results__content"></div>
    </div>
  </div>
</div>

              <a href="#" class="toc__close js-toc-close" aria-controls="toc" aria-label="Hide table of contents"></a>
              <nav id="toc" class="js-toc-list toc__list" aria-labelledby="toc-heading">
                  <a href='/manual.html' class="toc__back-link govuk-link">&lsaquo; Manual</a>
  <ul>
  <li>
    <a href="#header"><span>Environment data sync</span></a>
    <ul>
      <li>
        <a href="#what-it-does"><span>What it does</span></a>
        <ul>
          <li>
            <a href="#data-sanitisation"><span>Data sanitisation</span></a>
          </li>
        </ul>
      </li>
      <li>
        <a href="#how-it-works"><span>How it works</span></a>
        <ul>
          <li>
            <a href="#example-configuration"><span>Example configuration</span></a>
          </li>
          <li>
            <a href="#meanings-of-parameters"><span>Meanings of parameters</span></a>
          </li>
        </ul>
      </li>
      <li>
        <a href="#pausing-a-data-sync"><span>Pausing a data sync</span></a>
        <ul>
          <li>
            <a href="#resuming-a-data-sync"><span>Resuming a data sync</span></a>
          </li>
        </ul>
      </li>
      <li>
        <a href="#resources-managed-by-puppet"><span>Resources managed by Puppet</span></a>
        <ul>
          <li>
            <a href="#configuration-files-on-machines"><span>Configuration files on machines</span></a>
          </li>
          <li>
            <a href="#lock"><span>Lock</span></a>
          </li>
          <li>
            <a href="#cron-jobs-and-icinga-checks"><span>Cron jobs and Icinga checks</span></a>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>


              </nav>
            </div>
          </div>

        <div class="app-pane__content toc-open-disabled">
          <main id="content" class="technical-documentation" data-module="anchored-headings">
            
  <p><a href='/manual.html#monitoring'>Monitoring</a></p>   <div class="govuk-!-font-size-16 govuk-!-margin-top-6">

  Last updated: <a href="https://github.com/alphagov/govuk-developer-docs/commit/346398f06a71d53cd91633fd0c059f408ae4c64b">10 Nov 2020</a>
</div>

 <h1 id='header'>Environment data sync</h1> <p>The <a href="https://github.com/alphagov/govuk-puppet/tree/master/modules/govuk_env_sync">govuk_env_sync</a> data sync is used for backup and sync tasks in the <a href="/manual/environments.html">GOV.UK AWS environments</a>. It replaces the now archived <a href="https://github.com/alphagov/env-sync-and-backup">env-sync-and-backup</a> data sync.</p>

<h2 id="what-it-does">What it does</h2>

<p>In this context:</p>

<ul>
  <li><strong>Push</strong> means <em>database dump and upload</em>.</li>
  <li><strong>Pull</strong> means <em>download and database restore</em>.</li>
</ul>

<p>The govuk_env_sync data sync works by <code>push</code>ing a source database to S3 and subsequently <code>pull</code>ing it down from there to a destination. There is a different process for the Elasticsearch databases, which <a href="https://github.com/alphagov/govuk-puppet/blob/cb9351f92456ccf132e776b3b9f7129c0e654697/modules/govuk_env_sync/files/govuk_env_sync.sh#L496-L504">don't push/pull</a> but instead get <a href="https://github.com/alphagov/govuk-puppet/blob/cb9351f92456ccf132e776b3b9f7129c0e654697/modules/govuk_env_sync/files/govuk_env_sync.sh#L321-L337">copied to another Elasticsearch</a>.</p>

<p>The environment synchronisation is achieved by granting cross-account access of the <code>govuk-&lt;environment&gt;-database-backups</code> S3 buckets. Figure 1 below illustrates the intended data flow between environments.</p>

<p><img src="/manual/images/govuk_env_sync.png" alt="Schematic of the data flow of the govuk_env_sync data synchronisation" />
Figure 1:  Schematic of the data flow of the govuk_env_sync data synchronisation.</p>

<p>In practice, some Integration databases pull from Production (with data sanitisation - see below) rather than from Staging. This is done to reduce the number of cron job timing dependencies and to save resources where large databases do not need to be backed up from Staging.</p>

<h3 id="data-sanitisation">Data sanitisation</h3>

<p>Data sanitisation (removal of sensitive data) for the Integration environment is done by SQL scripts which run as part of the restore transaction at the destination. While not ideal, this is the same approach as <a href="https://github.com/alphagov/env-sync-and-backup">env-sync-and-backup</a> used to use and allows reuse of the same sanitisation scripts.</p>

<p>Data sanitisation scripts are in the <a href="https://github.com/alphagov/govuk-puppet/tree/master/modules/govuk_env_sync/files/transformation_sql"><code>files/transformation_sql</code></a> directory. These are created under <code>/etc/govuk_env_sync/transformation_sql/</code> on the target machine.</p>

<h2 id="how-it-works">How it works</h2>

<p>The code is in the govuk_env_sync module in the govuk-puppet repository. Most of the logic is in the <a href="https://github.com/alphagov/govuk-puppet/blob/master/modules/govuk_env_sync/files/govuk_env_sync.sh">govuk_env_sync.sh</a> file, provided as a Puppet file resource in the <code>files</code> directory. It is created as <code>/usr/local/bin/govuk_env_sync.sh</code>. Rollout of changes to this code happens as part of the the <code>Deploy_puppet</code> Jenkins job in each environment.</p>

<p>A <a href="https://github.com/alphagov/govuk-puppet/blob/ba370cf5970eb9023c0de5153f6acbb31aceca6b/modules/govuk_env_sync/manifests/task.pp"><code>govuk_env_sync::task</code> resource type</a> creates a configuration file and a cron job, parameterising the govuk_env_sync.sh file with the values passed to <code>govuk_env_sync::task</code>. A <a href="https://github.com/alphagov/govuk-puppet/blob/8195aa1483bc3030204e840b0b4f8a3cecab4d93/modules/govuk_env_sync/manifests/init.pp#L27"><code>create_resources(govuk_env_sync::task)</code> invocation</a> calls the <code>govuk_env_sync::task</code> for each <code>govuk_env_sync::tasks:</code> property in the hieradata. Most (but not all) of these are in <code>db_admin.yaml</code> under <code>hieradata_aws/class/{integration,staging,production}</code> (here's an <a href="https://github.com/alphagov/govuk-puppet/blob/25aba8fcf206a0685c3628e1f30b423110fbe84f/hieradata_aws/class/staging/db_admin.yaml">example of one</a>). All can be found via <code>git grep govuk_env_sync::tasks</code> within the govuk-puppet repo.</p>

<p>There are separate backup and restore tasks for each database in each environment, all with different start times, so it is difficult to pinpoint exactly when the govuk_env_sync starts and ends. However, the data sync period is generally expected to run from around <a href="https://github.com/alphagov/govuk-puppet/blob/cb9351f92456ccf132e776b3b9f7129c0e654697/modules/govuk/lib/puppet/parser/functions/data_sync_times.rb#L6-L9">10pm until 8am</a>. For this reason:</p>

<blockquote>
  <p><strong>Traffic replay using <a href="/manual/alerts/goreplay.html">GoReplay</a> is disabled between 22:00 and
08:00 UTC daily whilst the data sync pull jobs take place. This is to prevent
lots of errors while we are dropping databases.</strong></p>
</blockquote>

<h3 id="example-configuration">Example configuration</h3>

<div class="highlight"><pre class="highlight plaintext"><code>govuk_env_sync::tasks:
  "pull_publishing_api_production_daily":
    ensure: "present"
    hour: "2"
    minute: "40"
    action: "pull"
    dbms: "postgresql"
    storagebackend: "s3"
    database: "publishing_api_production"
    temppath: "/tmp/publishing_api_production"
    url: "govuk-production-database-backups"
    path: "postgresql-backend"
    transformation_sql_filename: "sanitise_publishing_api_production.sql"
</code></pre></div>
<h3 id="meanings-of-parameters">Meanings of parameters</h3>

<p>See <a href="https://github.com/alphagov/govuk-puppet/blob/master/modules/govuk_env_sync/files/govuk_env_sync.sh">govuk_env_sync.sh</a> for full documentation of the parameters.</p>

<table>
  <thead>
    <tr>
      <th>key</th>
      <th>description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>title</code></td>
      <td>Free text used in monitoring alerts.</td>
    </tr>
    <tr>
      <td><code>ensure</code></td>
      <td>One of <code>present</code>, <code>disabled</code> or <code>absent</code> to control the task. <code>disabled</code> creates the config file but removes the cron job and is used for configuring restores in Production.</td>
    </tr>
    <tr>
      <td><code>hour</code></td>
      <td>Hour of (daily) cron-job execution.</td>
    </tr>
    <tr>
      <td><code>minute</code></td>
      <td>Minute of (daily) cron-job execution.</td>
    </tr>
    <tr>
      <td><code>action</code></td>
      <td>One of <code>push</code> (dump db and upload to store) or <code>pull</code> (download from store and restore db).</td>
    </tr>
    <tr>
      <td><code>dbms</code></td>
      <td>One of <code>postgresql</code>, <code>mysql</code>, <code>mongo</code>, <code>elasticsearch</code>.</td>
    </tr>
    <tr>
      <td><code>storagebackend</code></td>
      <td>Must be <code>elasticsearch</code> if <code>dbms</code> is <code>elasticsearch</code>, otherwise must be <code>s3</code>.</td>
    </tr>
    <tr>
      <td><code>database</code></td>
      <td>Database name, as configured in the DBMS.</td>
    </tr>
    <tr>
      <td><code>temppath</code></td>
      <td>Temporary storage path on the machine which runs the cronjob.</td>
    </tr>
    <tr>
      <td><code>url</code></td>
      <td>S3 bucket name or Elasticsearch snapshot name.</td>
    </tr>
    <tr>
      <td><code>path</code></td>
      <td>Object-prefix (in S3) or directory path.</td>
    </tr>
    <tr>
      <td><code>transformation_sql_file</code></td>
      <td>Optional path to a SQL script to run within the transaction when restoring a Postgres database, after the data has been inserted.</td>
    </tr>
  </tbody>
</table>

<p>On manual execution, the script takes the arguments:</p>

<table>
  <thead>
    <tr>
      <th>flag</th>
      <th>argument</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>-f</td>
      <td><code>configfile</code></td>
    </tr>
    <tr>
      <td>-a</td>
      <td><code>action</code></td>
    </tr>
    <tr>
      <td>-D</td>
      <td><code>dbms</code></td>
    </tr>
    <tr>
      <td>-S</td>
      <td><code>storagebackend</code></td>
    </tr>
    <tr>
      <td>-T</td>
      <td><code>temppath</code></td>
    </tr>
    <tr>
      <td>-d</td>
      <td><code>database</code></td>
    </tr>
    <tr>
      <td>-u</td>
      <td><code>url</code></td>
    </tr>
    <tr>
      <td>-p</td>
      <td><code>path</code></td>
    </tr>
    <tr>
      <td>-s</td>
      <td><code>transformation_sql_file</code></td>
    </tr>
    <tr>
      <td>-t</td>
      <td><code>timestamp</code></td>
    </tr>
  </tbody>
</table>

<p>Here the timestamp argument is optional and allow to specify which timestamp (iso-datetime string of the form <code>YYYY-MM-DDTHH:MM</code>) should be restored during a <code>pull</code> operation (default is using the latest available dump).</p>

<h2 id="pausing-a-data-sync">Pausing a data sync</h2>

<p>If you need to temporarily pause one of the data syncs, it can be done manually:</p>

<ol>
  <li>
    <p>On the <code>db_admin</code> machine for the environment you want to disable the sync
in, Puppet will need to be disabled so the paused jobs aren't
automatically restarted:</p>

<div class="highlight"><pre class="highlight shell"><code><span class="nv">$ </span>govuk_puppet <span class="nt">--disable</span> <span class="s2">"paused for data sync"</span>
</code></pre></div>  </li>
  <li>
    <p>You can then list the cron jobs to find the right <code>pull</code> job for the app(s),
then edit the crontab and remove the corresponding line(s):</p>

<div class="highlight"><pre class="highlight shell"><code><span class="c"># list</span>
<span class="nv">$ </span><span class="nb">sudo </span>crontab <span class="nt">-lu</span> govuk-backup
<span class="c"># edit</span>
<span class="nv">$ </span><span class="nb">sudo </span>crontab <span class="nt">-u</span> govuk-backup <span class="nt">-e</span>
</code></pre></div>  </li>
  <li>
    <p>This will need to be done separately in each environment where the jobs need
to be paused.</p>
  </li>
</ol>

<h3 id="resuming-a-data-sync">Resuming a data sync</h3>

<p>To resume the jobs again you can re-enable Puppet and run it manually:</p>

<div class="highlight"><pre class="highlight shell"><code><span class="nv">$ </span>govuk_puppet <span class="nt">--enable</span>
<span class="nv">$ </span>govuk_puppet <span class="nt">--test</span>
</code></pre></div>
<h2 id="resources-managed-by-puppet">Resources managed by Puppet</h2>

<h3 id="configuration-files-on-machines">Configuration files on machines</h3>

<p>Puppet creates a configuration file in <code>/etc/govuk_env_sync/</code> for each job in hieradata <code>govuk_env_sync::tasks:</code>. These files consist of simple <code>source</code>-able variable assignments of the form:</p>

<div class="highlight"><pre class="highlight plaintext"><code>action="pull"
dbms="postgresql"
storagebackend="s3"
temppath="/tmp/content_data_admin_production_pull"
database="content_data_admin_production"
url="govuk-production-database-backups"
path="postgresql-backend"
</code></pre></div>
<h3 id="lock">Lock</h3>

<p>The govuk_env_sync cron jobs prevent automated reboots by <code>unattended-upgrades</code> by running under <code>/usr/local/bin/with_reboot_lock</code>, which creates the file <code>/etc/unattended-reboot/no-reboot/govuk_env_sync</code> and removes it when the process exits.</p>

<h3 id="cron-jobs-and-icinga-checks">Cron jobs and Icinga checks</h3>

<p>If you get an Icinga alert about a failing task, check <code>/var/log/syslog</code> and <code>/var/log/syslog.1</code> on the machine which runs the job. If the logs don't help, you can try re-running the sync job.</p>

<p>The data sync operations are executed as cron-jobs attached to the <code>govuk-backup</code> user. Run the following commands to get an overview of the jobs being run on a machine.</p>

<div class="highlight"><pre class="highlight shell"><code><span class="nv">$ </span><span class="nb">sudo </span>crontab <span class="nt">-lu</span> govuk-backup

<span class="c"># Puppet Name: pull_content_data_admin_production_daily</span>
18 0 <span class="k">*</span> <span class="k">*</span> <span class="k">*</span> /usr/bin/ionice <span class="nt">-c</span> 2 <span class="nt">-n</span> 6 /usr/local/bin/with_reboot_lock /usr/bin/envdir /etc/govuk_env_sync/env.d /usr/local/bin/govuk_env_sync.sh <span class="nt">-f</span> /etc/govuk_env_sync/pull_content_data_admin_production_daily.cfg
...

</code></pre></div>
<p>The cron job command does the following:</p>

<ol>
  <li>Runs the data sync job at low I/O priority:
<code>/usr/bin/ionice -c 2 -n 6</code>. This only really matters when running on a database server, as opposed to a <code>db_admin</code> bastion host, but the command is the same in both cases.</li>
  <li>Prevents reboot by <code>unattended-upgrades</code> while the sync job is running:
<code>/usr/local/bin/with_reboot_lock</code></li>
  <li>Runs the data sync job with the appropriate configuration file:
<code>/usr/local/bin/govuk_env_sync.sh -f /etc/govuk_env_sync/pull_content_data_admin_production_daily.cfg</code></li>
</ol>

<p>To re-run a given sync job, copy the part of the cron-job corresponding to (3) and examine the output for any errors.</p>

<div class="highlight"><pre class="highlight shell"><code><span class="nb">sudo</span> <span class="nt">-u</span> govuk-backup /usr/local/bin/govuk_env_sync.sh <span class="nt">-f</span> /etc/govuk_env_sync/pull_content_data_admin_production_daily.cfg
</code></pre></div>


  <div class='related-content'>

    <h3>More in the Monitoring section</h3>

    <div class='govuk-grid-row'>
        <div class='govuk-grid-column-one-half'>
          <h4>Learn</h4>

          <ul class="govuk-list">
            <li><a href="/manual/error-reporting.html">Error reporting with Sentry</a></li>
            <li><a href="/manual/grafana.html">Grafana</a></li>
            <li><a href="/manual/graphite-and-deployment-dashboards.html">Graphite and deployment dashboards</a></li>
            <li><a href="/manual/icinga.html">Icinga</a></li>
            <li><a href="/manual/metrics.html">Metrics</a></li>
            <li><a href="/manual/pingdom-bouncer-canary-check.html">Pingdom Bouncer canary check</a></li>
            <li><a href="/manual/screens.html">Screens that we have in the office</a></li>
            <li><a href="/manual/sidekiq.html">Sidekiq</a></li>
            <li><a href="/manual/tools.html">Tools: Icinga, Grafana and Graphite, Kibana, Fabric and friends</a></li>
            <li><a href="/manual/uptime-metrics.html">Uptime Metrics</a></li>
          </ul>
        </div>

        <div class='govuk-grid-column-one-half'>
          <h4>How to...</h4>

          <ul class="govuk-list">
            <li><a href="/manual/add-a-pingdom-check.html">Add a Pingdom check</a></li>
            <li><a href="/manual/add-an-icinga-passive-check.html">Add an Icinga passive check to a Jenkins job</a></li>
            <li><a href="/manual/nagios-nrpe-connection-failures.html">Debug Nagios NRPE connection failures</a></li>
            <li><a href="/manual/debug-underperforming-search.html">Debug underperforming search</a></li>
            <li><a href="/manual/errors.html">How we handle errors</a></li>
            <li><a href="/manual/nagstamon.html">Use Nagstamon for monitoring Icinga</a></li>
          </ul>
        </div>

    </div>
</div>


            
          </main>

          <aside>
              <ul class="contribution-banner">
                <li><a href="https://github.com/alphagov/govuk-developer-docs/blob/master/source/manual/govuk-env-sync.html.md">View source</a></li>
                <li><a href="https://github.com/alphagov/govuk-developer-docs/issues/new?labels=bug&amp;title=Re:%20'Environment%20data%20sync'&amp;body=Problem%20with%20'Environment%20data%20sync'%20(https://docs.publishing.service.gov.uk/manual/govuk-env-sync.html)">Report problem</a></li>
                <li><a href="https://github.com/alphagov/govuk-developer-docs">GitHub Repo</a></li>
              </ul>
          </aside>

          <footer class="govuk-footer app-footer" role="contentinfo">
  <div class="govuk-footer__meta">
    <div class="govuk-footer__meta-item govuk-footer__meta-item--grow">

        <ul class="govuk-footer__inline-list">
            <li class="govuk-footer__inline-list-item">
              <a class="govuk-footer__link" href="/accessibility.html">Accessibility</a>
            </li>
        </ul>

      <svg
        aria-hidden="true"
        focusable="false"
        class="govuk-footer__licence-logo"
        xmlns="http://www.w3.org/2000/svg"
        viewbox="0 0 483.2 195.7"
        height="17"
        width="41"
      >
        <path
          fill="currentColor"
          d="M421.5 142.8V.1l-50.7 32.3v161.1h112.4v-50.7zm-122.3-9.6A47.12 47.12 0 0 1 221 97.8c0-26 21.1-47.1 47.1-47.1 16.7 0 31.4 8.7 39.7 21.8l42.7-27.2A97.63 97.63 0 0 0 268.1 0c-36.5 0-68.3 20.1-85.1 49.7A98 98 0 0 0 97.8 0C43.9 0 0 43.9 0 97.8s43.9 97.8 97.8 97.8c36.5 0 68.3-20.1 85.1-49.7a97.76 97.76 0 0 0 149.6 25.4l19.4 22.2h3v-87.8h-80l24.3 27.5zM97.8 145c-26 0-47.1-21.1-47.1-47.1s21.1-47.1 47.1-47.1 47.2 21 47.2 47S123.8 145 97.8 145"
        />
      </svg>
      <span class="govuk-footer__licence-description">
        All content is available under the
        <a
          class="govuk-footer__link"
          href="https://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/"
          rel="license"
        >Open Government Licence v3.0</a>, except where otherwise stated
      </span>
    </div>
    <div class="govuk-footer__meta-item">
      <a
        class="govuk-footer__link govuk-footer__copyright-logo"
        href="https://www.nationalarchives.gov.uk/information-management/re-using-public-sector-information/uk-government-licensing-framework/crown-copyright/"
      >Â© Crown copyright</a>
    </div>
  </div>
</footer>

        </div>
      </div>
    </div>

    
    <script src="/javascripts/application.js"></script>
  </body>
</html>
