




<!doctype html>
<html lang="en" class="govuk-template no-js">
  <head>
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">

    <title>Licensify - supporting licensing - GOV.UK Developer Documentation</title>

    <link href="/stylesheets/manifest.css" rel="stylesheet" />

    <link rel="canonical" href="https://docs.publishing.service.gov.uk/manual/licensing.html">

      <meta name="twitter:card" content="summary" />
      <meta name="twitter:domain" content="docs.publishing.service.gov.uk" />
      <meta name="twitter:image" content="https://docs.publishing.service.gov.uk/images/govuk-large.png" />
      <meta name="twitter:title" content="Licensify - supporting licensing - GOV.UK Developer Documentation" />
      <meta name="twitter:url" content="https://docs.publishing.service.gov.uk/manual/licensing.html" />

      <meta property="og:image" content="https://docs.publishing.service.gov.uk/images/govuk-large.png" />
      <meta property="og:site_name" content="GOV.UK Developer Documentation" />
      <meta property="og:title" content="Licensify - supporting licensing" />
      <meta property="og:type" content="object" />
      <meta property="og:url" content="https://docs.publishing.service.gov.uk/manual/licensing.html" />

    
  </head>

  <body class="govuk-template__body">
    <script>document.body.className = ((document.body.className) ? document.body.className + ' js-enabled' : 'js-enabled');</script>

    <div class="app-pane">
      <div class="app-pane__header toc-open-disabled">
        <a href="#content" class="govuk-skip-link">Skip to main content</a>

        <header class="govuk-header app-header" role="banner" data-module="govuk-header">
  <div class="govuk-header__container govuk-header__container--full-width">
    <div class="govuk-header__logo">
      <a href="/" class="govuk-header__link govuk-header__link--homepage">
        <span class="govuk-header__logotype">
          <svg
            aria-hidden="true"
            focusable="false"
            class="govuk-header__logotype-crown"
            xmlns="http://www.w3.org/2000/svg"
            viewbox="0 0 132 97"
            height="30"
            width="36"
          >
            <path
              fill="currentColor" fill-rule="evenodd"
              d="M25 30.2c3.5 1.5 7.7-.2 9.1-3.7 1.5-3.6-.2-7.8-3.9-9.2-3.6-1.4-7.6.3-9.1 3.9-1.4 3.5.3 7.5 3.9 9zM9 39.5c3.6 1.5 7.8-.2 9.2-3.7 1.5-3.6-.2-7.8-3.9-9.1-3.6-1.5-7.6.2-9.1 3.8-1.4 3.5.3 7.5 3.8 9zM4.4 57.2c3.5 1.5 7.7-.2 9.1-3.8 1.5-3.6-.2-7.7-3.9-9.1-3.5-1.5-7.6.3-9.1 3.8-1.4 3.5.3 7.6 3.9 9.1zm38.3-21.4c3.5 1.5 7.7-.2 9.1-3.8 1.5-3.6-.2-7.7-3.9-9.1-3.6-1.5-7.6.3-9.1 3.8-1.3 3.6.4 7.7 3.9 9.1zm64.4-5.6c-3.6 1.5-7.8-.2-9.1-3.7-1.5-3.6.2-7.8 3.8-9.2 3.6-1.4 7.7.3 9.2 3.9 1.3 3.5-.4 7.5-3.9 9zm15.9 9.3c-3.6 1.5-7.7-.2-9.1-3.7-1.5-3.6.2-7.8 3.7-9.1 3.6-1.5 7.7.2 9.2 3.8 1.5 3.5-.3 7.5-3.8 9zm4.7 17.7c-3.6 1.5-7.8-.2-9.2-3.8-1.5-3.6.2-7.7 3.9-9.1 3.6-1.5 7.7.3 9.2 3.8 1.3 3.5-.4 7.6-3.9 9.1zM89.3 35.8c-3.6 1.5-7.8-.2-9.2-3.8-1.4-3.6.2-7.7 3.9-9.1 3.6-1.5 7.7.3 9.2 3.8 1.4 3.6-.3 7.7-3.9 9.1zM69.7 17.7l8.9 4.7V9.3l-8.9 2.8c-.2-.3-.5-.6-.9-.9L72.4 0H59.6l3.5 11.2c-.3.3-.6.5-.9.9l-8.8-2.8v13.1l8.8-4.7c.3.3.6.7.9.9l-5 15.4v.1c-.2.8-.4 1.6-.4 2.4 0 4.1 3.1 7.5 7 8.1h.2c.3 0 .7.1 1 .1.4 0 .7 0 1-.1h.2c4-.6 7.1-4.1 7.1-8.1 0-.8-.1-1.7-.4-2.4V34l-5.1-15.4c.4-.2.7-.6 1-.9zM66 92.8c16.9 0 32.8 1.1 47.1 3.2 4-16.9 8.9-26.7 14-33.5l-9.6-3.4c1 4.9 1.1 7.2 0 10.2-1.5-1.4-3-4.3-4.2-8.7L108.6 76c2.8-2 5-3.2 7.5-3.3-4.4 9.4-10 11.9-13.6 11.2-4.3-.8-6.3-4.6-5.6-7.9 1-4.7 5.7-5.9 8-.5 4.3-8.7-3-11.4-7.6-8.8 7.1-7.2 7.9-13.5 2.1-21.1-8 6.1-8.1 12.3-4.5 20.8-4.7-5.4-12.1-2.5-9.5 6.2 3.4-5.2 7.9-2 7.2 3.1-.6 4.3-6.4 7.8-13.5 7.2-10.3-.9-10.9-8-11.2-13.8 2.5-.5 7.1 1.8 11 7.3L80.2 60c-4.1 4.4-8 5.3-12.3 5.4 1.4-4.4 8-11.6 8-11.6H55.5s6.4 7.2 7.9 11.6c-4.2-.1-8-1-12.3-5.4l1.4 16.4c3.9-5.5 8.5-7.7 10.9-7.3-.3 5.8-.9 12.8-11.1 13.8-7.2.6-12.9-2.9-13.5-7.2-.7-5 3.8-8.3 7.1-3.1 2.7-8.7-4.6-11.6-9.4-6.2 3.7-8.5 3.6-14.7-4.6-20.8-5.8 7.6-5 13.9 2.2 21.1-4.7-2.6-11.9.1-7.7 8.8 2.3-5.5 7.1-4.2 8.1.5.7 3.3-1.3 7.1-5.7 7.9-3.5.7-9-1.8-13.5-11.2 2.5.1 4.7 1.3 7.5 3.3l-4.7-15.4c-1.2 4.4-2.7 7.2-4.3 8.7-1.1-3-.9-5.3 0-10.2l-9.5 3.4c5 6.9 9.9 16.7 14 33.5 14.8-2.1 30.8-3.2 47.7-3.2z"
            ></path>
            <image src="/assets/images/govuk-logotype-crown.png" xlink:href="" class="govuk-header__logotype-crown-fallback-image" width="36" height="32"></image>
          </svg>
          <span class="govuk-header__logotype-text">
            GOV.UK
          </span>
        </span>
        <span class="govuk-header__product-name">
          Developer docs
        </span>
      </a>
    </div>
    <div class="govuk-header__content">
      <button type="button" class="govuk-header__menu-button govuk-js-header-toggle" aria-controls="navigation" aria-label="Show or hide Top Level Navigation">Menu</button>
      <nav>
        <ul id="navigation" class="govuk-header__navigation govuk-header__navigation--end" aria-label="Top Level Navigation">
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/">Dashboard</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/manual/get-started.html">Get started</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/apps.html">Apps</a>
            </li>
            <li class="govuk-header__navigation-item govuk-header__navigation-item--active">
              <a class="govuk-header__link" href="/manual.html">Manual</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/apis.html">APIs</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/content-schemas.html">Schemas</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/document-types.html">Document types</a>
            </li>
        </ul>
      </nav>
    </div>
  </div>
</header>

      </div>

        <div id="toc-heading" class="toc-show fixedsticky">
          <a href="#toc" class="toc-show__label js-toc-show" aria-controls="toc">
            Table of contents <span class="toc-show__icon"></span>
          </a>
        </div>

      <div class="app-pane__body">
          <div class="app-pane__toc">
            <div class="toc" data-module="table-of-contents">
              <div class="search" data-module="search">
  <form action="https://www.google.co.uk/search" method="get" role="search">
    <input type="hidden" name="as_sitesearch" value="https://docs.publishing.service.gov.uk"/>
    <label class="govuk-label search__label" for="search">
      Search (via Google)
    </label>
    <input class="govuk-input govuk-!-margin-bottom-4" id="search" name="q" type="text" aria-controls="search-results" placeholder="Search">
  </form>
  <div id="search-results" class="search-results" aria-hidden="true" role="dialog" aria-labelledby="search-results-title">
    <div class="search-results__inner">
      <button class="search-results__close">Close<span class="search-results__close-label"> search results</span></button>
      <h2 id="search-results-title" class="search-results__title" aria-live="polite">Results</h2>
      <div class="search-results__content"></div>
    </div>
  </div>
</div>

              <a href="#" class="toc__close js-toc-close" aria-controls="toc" aria-label="Hide table of contents"></a>
              <nav id="toc" class="js-toc-list toc__list" aria-labelledby="toc-heading">
                  <a href='/manual.html' class="toc__back-link govuk-link">&lsaquo; Manual</a>
  <ul>
  <li>
    <a href="#header"><span>Licensify - supporting licensing</span></a>
    <ul>
      <li>
        <a href="#overview"><span>Overview</span></a>
        <ul>
          <li>
            <a href="#applications"><span>Applications</span></a>
          </li>
          <li>
            <a href="#finding-a-licence"><span>Finding a licence</span></a>
          </li>
          <li>
            <a href="#applying-for-a-licence"><span>Applying for a licence</span></a>
          </li>
        </ul>
      </li>
      <li>
        <a href="#testing"><span>Testing</span></a>
      </li>
      <li>
        <a href="#debugging"><span>Debugging</span></a>
      </li>
      <li>
        <a href="#email"><span>Email</span></a>
      </li>
      <li>
        <a href="#apto-solutions"><span>Apto Solutions</span></a>
      </li>
      <li>
        <a href="#data"><span>Data</span></a>
        <ul>
          <li>
            <a href="#application-files"><span>Application Files</span></a>
          </li>
          <li>
            <a href="#anti-virus-scans-of-uploaded-documents"><span>Anti-virus scans of uploaded documents</span></a>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>


              </nav>
            </div>
          </div>

        <div class="app-pane__content toc-open-disabled">
          <main id="content" class="technical-documentation" data-module="anchored-headings">
            
  <p><a href='/manual.html#2nd-line'>2nd line</a></p>   <div class="govuk-!-font-size-16 govuk-!-margin-top-6">
  Last updated: <a href="https://github.com/alphagov/govuk-developer-docs/commit/01a7b95f8441ead06a6ca0107b083c09f9892d30">11 Sep 2020</a>
</div>

 <h1 id='header'>Licensify - supporting licensing</h1> <p>GOV.UK runs a Scala application (<a href="/apps/licensify.html">Licensify</a>) which allows users to apply and pay for licences from local authorities and other competent authorities.</p>

<h2 id="overview">Overview</h2>

<p>There is a <a href="https://licensify-admin.publishing.service.gov.uk/assets/manual.pdf">PDF user manual</a> available which includes a lot of detail about the backend (administration) facilities available through the GOV.UK Licensing service.</p>

<h3 id="applications">Applications</h3>

<p>The Licensing service consists of <a href="https://github.com/alphagov/govuk-puppet/blob/f45e303e4e2555ac8cdc003898f17e4dbe86add5/hieradata_aws/common.yaml#L132-L140">three separately deployed applications</a>:</p>

<ul>
  <li><code>licensify</code> (on the <code>licensing_frontend</code> machine): the interface used by citizens and businesses who want to apply for a license. Allows them to download the relevant forms, submit them once completed, and also handles redirection to the relevant payment service if a fee is required.</li>
  <li><code>licensify-admin</code> (on the <code>licensing_backend</code> machine): administrative interface for LAs to allow them to view and download applications from users. Also provides the ability for LA admin users to set up customisations (the specifics of the licence types) for their LA, and for GDS admins to control which licence types are available for each LA, and configuration like which payment provider the LA uses.</li>
  <li><code>licensify-feed</code> (on the <code>licensing_backend</code> machine): backend (asynchronous) processing of application uploads and processing (via Apto), email notifications (via GOV.UK Notify), and expiry and purging of old applications. Also provides an interface for some debugging-type reporting.</li>
</ul>

<h3 id="finding-a-licence">Finding a licence</h3>

<p>Users use <a href="https://www.gov.uk/licence-finder">Licence Finder</a> to locate licences on the GOV.UK frontend, but from a technical perspective this is separate from Licensify.</p>

<p>Licence Finder sends users to a "Licence" page served by <a href="/apps/frontend.html">Frontend</a>. Users enter their postcode and Frontend uses <a href="/apps/mapit.html">Mapit</a> to <a href="https://github.com/alphagov/frontend/blob/8dbe0f0f6ca0f5a777a0d6ca77b858fe5adc2494/app/controllers/licence_controller.rb#L83">find their local authority</a>. Frontend makes a request to a Licensify API to find out whether the licence is available on GOV.UK.</p>

<h3 id="applying-for-a-licence">Applying for a licence</h3>

<p>Licence applications handled by Licensify are processed as follows:</p>

<ol>
  <li>User downloads a PDF application form and completes it either in Adobe Reader or by hand.</li>
  <li>User uploads the completed application form to Licensify, and provides their email address and consents to a legal declaration.</li>
  <li>User is provided with receipt of application by email, and an email is sent to the relevant authority to inform them that an application is available for viewing.</li>
  <li>Licensing authorities check <a href="https://licensify-admin.publishing.service.gov.uk/login">Licensify's admin interface</a> for new applications, then process them and either confirm or deny the application.</li>
</ol>

<h2 id="testing">Testing</h2>

<p>There is an example licence that you can use to test Licensify. Note that the following instructions are safe to run any number of times in production:</p>

<ol>
  <li>Go to <a href="https://www.gov.uk/apply-for-a-licence/test-licence/gds-test/apply-1">https://www.gov.uk/apply-for-a-licence/test-licence/gds-test/apply-1</a></li>
  <li>Download the PDF application form</li>
  <li>Click 'Submit application'</li>
  <li>Enter your email address, upload the application form you just downloaded and tick the checkbox to accept the declaration</li>
  <li>Click 'Continue to pay fee'</li>
  <li>Click 'Continue to WorldPay website'</li>
  <li>Enter a <a href="http://support.worldpay.com/support/kb/bg/testandgolive/tgl5103.html">test card number</a></li>
  <li>Make payment</li>
  <li>You should see a confirmation page and receive an email with same details</li>
  <li>Login to Licensify's admin interface to verify that your application is visible</li>
</ol>

<p>You can give the application reference to Kibana in the relevant environment to see the logs and any error messages. The application should speak to both the frontend and backend app servers at least once during the transaction. It may take up to five minutes to process the licence application, so it might be worth waiting for a few minutes before checking Kibana.</p>

<h2 id="debugging">Debugging</h2>

<p>The Feeds application has a UI that runs on port <code>9400</code>, but that isn't exposed publicly, so you need to tunnel to it. For example, the following will tunnel to the production instance of the Feeds admin and make it available via <code>localhost:9400</code>:</p>

<div class="highlight"><pre class="highlight shell"><code>gds govuk connect <span class="nt">-e</span> production ssh licensing_backend

<span class="c"># Look at the output and grab the IP address, e.g.</span>
<span class="c"># Running command: ssh -J username@jumpbox.production.govuk.digital username@ip-10-13-5-62.eu-west-1.compute.internal</span>

<span class="c"># now exit the machine and run this command locally, replacing the IP</span>
ssh username@ip-10-13-5-62.eu-west-1.compute.internal <span class="nt">-J</span> username@jumpbox.production.govuk.digital <span class="nt">-L</span> 9400:localhost:9400 <span class="nt">-N</span>
</code></pre></div>
<p>Once the tunnel above has been set up, the following pages are available:</p>

<ul>
  <li><a href="http://localhost:9400/licence-management/feed/process-applications">Unprocessed applications</a></li>
  <li><a href="http://localhost:9400/licence-management/feed/applications/purge-expired">Collected applications, ready to be purged</a></li>
  <li><a href="http://localhost:9400/licence-management/feed/uncollected-applications-to-expire">Uncollected applications, ready to expire</a></li>
  <li><a href="http://localhost:9400/licence-management/feed/uncollected-applications-to-purge">Uncollected applications, ready to purge</a></li>
  <li><a href="http://localhost:9400/licence-management/feed/submittedApplicationsReport">Submitted applications report</a></li>
</ul>

<h2 id="email">Email</h2>

<p>Mail from Licensify is handled by GOV.UK Notify using the HTTP API. Authentication is via an API key, which is provided as a <a href="https://github.com/alphagov/alphagov-deployment/blob/master/elms/deploy/config/gds-licensing-config.properties.production#L47">configuration parameter</a> to the backend app servers by Puppet.</p>

<h2 id="apto-solutions">Apto Solutions</h2>

<p>Apto Solutions is a third-party organisation who take the completed application forms uploaded as PDFs and convert the input into a format which can be read by the Licensify Admin application.</p>

<p>In order for this to work, the PDF forms are sent away from GOV.UK to Apto's infrastructure. This means that Apto must have a firewall rule in place to allow connections from the outbound (SNAT) GOV.UK IP address.</p>

<h2 id="data">Data</h2>

<p>Licensing data is stored in MongoDB and synced from production to staging. We don't sync the data to integration automatically because it contains personally-identifiable information.</p>

<p>You can manually copy data from staging to integration. These collections do not contain personal information so they're safe to copy:</p>

<div class="highlight"><pre class="highlight shell"><code><span class="k">for </span>c <span class="k">in </span>counters eula<span class="p">;</span> <span class="k">do </span>mongodump <span class="nt">-d</span> licensify <span class="nt">-c</span> <span class="nv">$c</span> <span class="nt">-o</span> ~/licensifydump<span class="p">;</span> <span class="k">done
for </span>c <span class="k">in </span>authorities authorityLicenceInteraction customisations departments elmsLicences settings<span class="p">;</span> <span class="k">do </span>mongodump <span class="nt">-d</span> licensify-refdata <span class="nt">-c</span> <span class="nv">$c</span> <span class="nt">-o</span> ~/licensifydump<span class="p">;</span> <span class="k">done
</span><span class="nb">tar </span>cvzf licensifydump.tar.gz licensifydump/
</code></pre></div>
<p>You can then copy this file onto an integration machine (possibly via your local machine) and restore the data:</p>

<div class="highlight"><pre class="highlight shell"><code><span class="nb">tar </span>xvzf licensifydump.tar.gz
mongorestore licensifydump/
</code></pre></div>
<p>Confusingly, some collections exist in both the <code>licensify</code> and the <code>licensify-refdata</code> database. If <code>db.collectionName.count() == 0</code> in one database, and <code>db.collectionName.count() != 0</code> in the other, then you should assume that the one with objects is the source of truth.</p>

<h3 id="application-files">Application Files</h3>

<p>All newly-uploaded documents are stored within an S3 bucket; the credentials for this are provided to the application as environment variables. This feature was enabled on 2016-10-18; any documents uploaded before then are stored in GridFS (Mongo).</p>

<h3 id="anti-virus-scans-of-uploaded-documents">Anti-virus scans of uploaded documents</h3>

<p>All documents uploaded as part of the application process are scanned using ClamAV. There is also a nightly process that runs on a cron to re-check any previously uploaded files against the latest definitions, but this <a href="https://github.com/alphagov/alphagov-deployment/blob/master/elms/deploy/config/gds-licensing-config.properties.production#L42">process is currently disabled</a>. The risks disabling this poses are mitigated due to the fact that we are purging all applications after 90+7 days.</p>


  <div class='related-content'>

    <h3>More in the 2nd line section</h3>

    <div class='govuk-grid-row'>
        <div class='govuk-grid-column-one-half'>
          <h4>Learn</h4>

          <ul class="govuk-list">
            <li><a href="/manual/2nd-line.html">2nd line</a></li>
            <li><a href="/manual/on-call.html">Out of hours support (on-call)</a></li>
            <li><a href="/manual/pagerduty.html">PagerDuty</a></li>
            <li><a href="/manual/rules-for-getting-production-access.html">Rules for getting production access</a></li>
            <li><a href="/manual/welcome-to-2nd-line.html">Welcome to 2nd line</a></li>
            <li><a href="/manual/zendesk.html">Zendesk</a></li>
          </ul>
        </div>

        <div class='govuk-grid-column-one-half'>
          <h4>How to...</h4>

          <ul class="govuk-list">
            <li><a href="/manual/change-in-hours-time-period-for-dst.html">Change in-hours time period for daylight savings</a></li>
            <li><a href="/manual/raising-issues-with-reliability-engineering.html">Raise issues with Reliability Engineering</a></li>
          </ul>
        </div>

    </div>
</div>


            
          </main>

          <aside>
              <ul class="contribution-banner">
                <li><a href="https://github.com/alphagov/govuk-developer-docs/blob/master/source/manual/licensing.html.md">View source</a></li>
                <li><a href="https://github.com/alphagov/govuk-developer-docs/issues/new?labels=bug&amp;title=Re:%20'Licensify%20-%20supporting%20licensing'&amp;body=Problem%20with%20'Licensify%20-%20supporting%20licensing'%20(https://docs.publishing.service.gov.uk/manual/licensing.html)">Report problem</a></li>
                <li><a href="https://github.com/alphagov/govuk-developer-docs">GitHub Repo</a></li>
              </ul>
          </aside>

          <footer class="govuk-footer app-footer" role="contentinfo">
  <div class="govuk-footer__meta">
    <div class="govuk-footer__meta-item govuk-footer__meta-item--grow">

        <ul class="govuk-footer__inline-list">
            <li class="govuk-footer__inline-list-item">
              <a class="govuk-footer__link" href="/accessibility.html">Accessibility</a>
            </li>
        </ul>

      <svg
        aria-hidden="true"
        focusable="false"
        class="govuk-footer__licence-logo"
        xmlns="http://www.w3.org/2000/svg"
        viewbox="0 0 483.2 195.7"
        height="17"
        width="41"
      >
        <path
          fill="currentColor"
          d="M421.5 142.8V.1l-50.7 32.3v161.1h112.4v-50.7zm-122.3-9.6A47.12 47.12 0 0 1 221 97.8c0-26 21.1-47.1 47.1-47.1 16.7 0 31.4 8.7 39.7 21.8l42.7-27.2A97.63 97.63 0 0 0 268.1 0c-36.5 0-68.3 20.1-85.1 49.7A98 98 0 0 0 97.8 0C43.9 0 0 43.9 0 97.8s43.9 97.8 97.8 97.8c36.5 0 68.3-20.1 85.1-49.7a97.76 97.76 0 0 0 149.6 25.4l19.4 22.2h3v-87.8h-80l24.3 27.5zM97.8 145c-26 0-47.1-21.1-47.1-47.1s21.1-47.1 47.1-47.1 47.2 21 47.2 47S123.8 145 97.8 145"
        />
      </svg>
      <span class="govuk-footer__licence-description">
        All content is available under the
        <a
          class="govuk-footer__link"
          href="https://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/"
          rel="license"
        >Open Government Licence v3.0</a>, except where otherwise stated
      </span>
    </div>
    <div class="govuk-footer__meta-item">
      <a
        class="govuk-footer__link govuk-footer__copyright-logo"
        href="https://www.nationalarchives.gov.uk/information-management/re-using-public-sector-information/uk-government-licensing-framework/crown-copyright/"
      >Â© Crown copyright</a>
    </div>
  </div>
</footer>

        </div>
      </div>
    </div>

    
    <script src="/javascripts/application.js"></script>
  </body>
</html>
