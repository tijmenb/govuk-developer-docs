




<!doctype html>
<html lang="en" class="govuk-template no-js">
  <head>
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">

    <title>Redirect a route - GOV.UK Developer Documentation</title>

    <link href="/stylesheets/manifest.css" rel="stylesheet" />

    <link rel="canonical" href="https://docs.publishing.service.gov.uk/manual/redirect-routes.html">

      <meta name="twitter:card" content="summary" />
      <meta name="twitter:domain" content="docs.publishing.service.gov.uk" />
      <meta name="twitter:image" content="https://docs.publishing.service.gov.uk/images/govuk-large.png" />
      <meta name="twitter:title" content="Redirect a route - GOV.UK Developer Documentation" />
      <meta name="twitter:url" content="https://docs.publishing.service.gov.uk/manual/redirect-routes.html" />

      <meta property="og:image" content="https://docs.publishing.service.gov.uk/images/govuk-large.png" />
      <meta property="og:site_name" content="GOV.UK Developer Documentation" />
      <meta property="og:title" content="Redirect a route" />
      <meta property="og:type" content="object" />
      <meta property="og:url" content="https://docs.publishing.service.gov.uk/manual/redirect-routes.html" />

    
  </head>

  <body class="govuk-template__body">
    <script>document.body.className = ((document.body.className) ? document.body.className + ' js-enabled' : 'js-enabled');</script>

    <div class="app-pane">
      <div class="app-pane__header toc-open-disabled">
        <a href="#content" class="govuk-skip-link">Skip to main content</a>

        <header class="govuk-header app-header" role="banner" data-module="govuk-header">
  <div class="govuk-header__container govuk-header__container--full-width">
    <div class="govuk-header__logo">
      <a href="/" class="govuk-header__link govuk-header__link--homepage">
        <span class="govuk-header__logotype">
          <svg
            aria-hidden="true"
            focusable="false"
            class="govuk-header__logotype-crown"
            xmlns="http://www.w3.org/2000/svg"
            viewbox="0 0 132 97"
            height="30"
            width="36"
          >
            <path
              fill="currentColor" fill-rule="evenodd"
              d="M25 30.2c3.5 1.5 7.7-.2 9.1-3.7 1.5-3.6-.2-7.8-3.9-9.2-3.6-1.4-7.6.3-9.1 3.9-1.4 3.5.3 7.5 3.9 9zM9 39.5c3.6 1.5 7.8-.2 9.2-3.7 1.5-3.6-.2-7.8-3.9-9.1-3.6-1.5-7.6.2-9.1 3.8-1.4 3.5.3 7.5 3.8 9zM4.4 57.2c3.5 1.5 7.7-.2 9.1-3.8 1.5-3.6-.2-7.7-3.9-9.1-3.5-1.5-7.6.3-9.1 3.8-1.4 3.5.3 7.6 3.9 9.1zm38.3-21.4c3.5 1.5 7.7-.2 9.1-3.8 1.5-3.6-.2-7.7-3.9-9.1-3.6-1.5-7.6.3-9.1 3.8-1.3 3.6.4 7.7 3.9 9.1zm64.4-5.6c-3.6 1.5-7.8-.2-9.1-3.7-1.5-3.6.2-7.8 3.8-9.2 3.6-1.4 7.7.3 9.2 3.9 1.3 3.5-.4 7.5-3.9 9zm15.9 9.3c-3.6 1.5-7.7-.2-9.1-3.7-1.5-3.6.2-7.8 3.7-9.1 3.6-1.5 7.7.2 9.2 3.8 1.5 3.5-.3 7.5-3.8 9zm4.7 17.7c-3.6 1.5-7.8-.2-9.2-3.8-1.5-3.6.2-7.7 3.9-9.1 3.6-1.5 7.7.3 9.2 3.8 1.3 3.5-.4 7.6-3.9 9.1zM89.3 35.8c-3.6 1.5-7.8-.2-9.2-3.8-1.4-3.6.2-7.7 3.9-9.1 3.6-1.5 7.7.3 9.2 3.8 1.4 3.6-.3 7.7-3.9 9.1zM69.7 17.7l8.9 4.7V9.3l-8.9 2.8c-.2-.3-.5-.6-.9-.9L72.4 0H59.6l3.5 11.2c-.3.3-.6.5-.9.9l-8.8-2.8v13.1l8.8-4.7c.3.3.6.7.9.9l-5 15.4v.1c-.2.8-.4 1.6-.4 2.4 0 4.1 3.1 7.5 7 8.1h.2c.3 0 .7.1 1 .1.4 0 .7 0 1-.1h.2c4-.6 7.1-4.1 7.1-8.1 0-.8-.1-1.7-.4-2.4V34l-5.1-15.4c.4-.2.7-.6 1-.9zM66 92.8c16.9 0 32.8 1.1 47.1 3.2 4-16.9 8.9-26.7 14-33.5l-9.6-3.4c1 4.9 1.1 7.2 0 10.2-1.5-1.4-3-4.3-4.2-8.7L108.6 76c2.8-2 5-3.2 7.5-3.3-4.4 9.4-10 11.9-13.6 11.2-4.3-.8-6.3-4.6-5.6-7.9 1-4.7 5.7-5.9 8-.5 4.3-8.7-3-11.4-7.6-8.8 7.1-7.2 7.9-13.5 2.1-21.1-8 6.1-8.1 12.3-4.5 20.8-4.7-5.4-12.1-2.5-9.5 6.2 3.4-5.2 7.9-2 7.2 3.1-.6 4.3-6.4 7.8-13.5 7.2-10.3-.9-10.9-8-11.2-13.8 2.5-.5 7.1 1.8 11 7.3L80.2 60c-4.1 4.4-8 5.3-12.3 5.4 1.4-4.4 8-11.6 8-11.6H55.5s6.4 7.2 7.9 11.6c-4.2-.1-8-1-12.3-5.4l1.4 16.4c3.9-5.5 8.5-7.7 10.9-7.3-.3 5.8-.9 12.8-11.1 13.8-7.2.6-12.9-2.9-13.5-7.2-.7-5 3.8-8.3 7.1-3.1 2.7-8.7-4.6-11.6-9.4-6.2 3.7-8.5 3.6-14.7-4.6-20.8-5.8 7.6-5 13.9 2.2 21.1-4.7-2.6-11.9.1-7.7 8.8 2.3-5.5 7.1-4.2 8.1.5.7 3.3-1.3 7.1-5.7 7.9-3.5.7-9-1.8-13.5-11.2 2.5.1 4.7 1.3 7.5 3.3l-4.7-15.4c-1.2 4.4-2.7 7.2-4.3 8.7-1.1-3-.9-5.3 0-10.2l-9.5 3.4c5 6.9 9.9 16.7 14 33.5 14.8-2.1 30.8-3.2 47.7-3.2z"
            ></path>
            <image src="/assets/images/govuk-logotype-crown.png" xlink:href="" class="govuk-header__logotype-crown-fallback-image" width="36" height="32"></image>
          </svg>
          <span class="govuk-header__logotype-text">
            GOV.UK
          </span>
        </span>
        <span class="govuk-header__product-name">
          Developer docs
        </span>
      </a>
    </div>
    <div class="govuk-header__content">
      <button type="button" class="govuk-header__menu-button govuk-js-header-toggle" aria-controls="navigation" aria-label="Show or hide Top Level Navigation">Menu</button>
      <nav>
        <ul id="navigation" class="govuk-header__navigation govuk-header__navigation--end" aria-label="Top Level Navigation">
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/">Dashboard</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/manual/get-started.html">Get started</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/apps.html">Apps</a>
            </li>
            <li class="govuk-header__navigation-item govuk-header__navigation-item--active">
              <a class="govuk-header__link" href="/manual.html">Manual</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/apis.html">APIs</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/content-schemas.html">Schemas</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/document-types.html">Document types</a>
            </li>
        </ul>
      </nav>
    </div>
  </div>
</header>

      </div>

        <div id="toc-heading" class="toc-show fixedsticky">
          <a href="#toc" class="toc-show__label js-toc-show" aria-controls="toc">
            Table of contents <span class="toc-show__icon"></span>
          </a>
        </div>

      <div class="app-pane__body">
          <div class="app-pane__toc">
            <div class="toc" data-module="table-of-contents">
              <div class="search" data-module="search">
  <form action="https://www.google.co.uk/search" method="get" role="search">
    <input type="hidden" name="as_sitesearch" value="https://docs.publishing.service.gov.uk"/>
    <label class="govuk-label search__label" for="search">
      Search (via Google)
    </label>
    <input class="govuk-input govuk-!-margin-bottom-4" id="search" name="q" type="text" aria-controls="search-results" placeholder="Search">
  </form>
  <div id="search-results" class="search-results" aria-hidden="true" role="dialog" aria-labelledby="search-results-title">
    <div class="search-results__inner">
      <button class="search-results__close">Close<span class="search-results__close-label"> search results</span></button>
      <h2 id="search-results-title" class="search-results__title" aria-live="polite">Results</h2>
      <div class="search-results__content"></div>
    </div>
  </div>
</div>

              <a href="#" class="toc__close js-toc-close" aria-controls="toc" aria-label="Hide table of contents"></a>
              <nav id="toc" class="js-toc-list toc__list" aria-labelledby="toc-heading">
                  <a href='/manual.html' class="toc__back-link govuk-link">&lsaquo; Manual</a>
  <ul>
  <li>
    <a href="#header"><span>Redirect a route</span></a>
    <ul>
      <li>
        <a href="#manually-apply-a-redirect-from-any-publishing-app"><span>Manually apply a redirect from any publishing app</span></a>
        <ul>
          <li>
            <a href="#manually-re-present-the-content-item-in-publishing-api"><span>Manually re-present the content item in Publishing API</span></a>
          </li>
          <li>
            <a href="#manually-register-a-route-in-content-store"><span>Manually register a route in Content Store</span></a>
          </li>
          <li>
            <a href="#manually-apply-a-redirect-in-router-api"><span>Manually apply a redirect in Router API</span></a>
          </li>
        </ul>
      </li>
      <li>
        <a href="#find-out-if-the-route-exists"><span>Find out if the route exists</span></a>
      </li>
      <li>
        <a href="#find-out-which-app-owns-the-route"><span>Find out which app owns the route</span></a>
      </li>
      <li>
        <a href="#redirect-using-the-short-url-manager"><span>Redirect using the Short URL Manager</span></a>
        <ul>
          <li>
            <a href="#removing-a-route-created-in-the-short-url-manager"><span>Removing a route created in the Short URL Manager</span></a>
          </li>
          <li>
            <a href="#removing-a-route-completely-so-it-can-be-replaced-with-another-route"><span>Removing a route completely so it can be replaced with another route</span></a>
          </li>
        </ul>
      </li>
      <li>
        <a href="#fixing-incorrect-corporate-information-page-redirects"><span>Fixing incorrect Corporate Information page redirects</span></a>
      </li>
      <li>
        <a href="#redirects-for-hmrc-manuals"><span>Redirects for HMRC manuals</span></a>
      </li>
      <li>
        <a href="#redirects-from-campaign-sites"><span>Redirects from campaign sites</span></a>
      </li>
    </ul>
  </li>
</ul>


              </nav>
            </div>
          </div>

        <div class="app-pane__content toc-open-disabled">
          <main id="content" class="technical-documentation" data-module="anchored-headings">
            
  <p><a href='/manual.html#routing'>Routing</a></p>   <div class="govuk-!-font-size-16 govuk-!-margin-top-6">

  Last updated: <a href="https://github.com/alphagov/govuk-developer-docs/commit/6ca2973a634bf0a669904f19b552a2441459f090">4 Dec 2020</a>
</div>

 <h1 id='header'>Redirect a route</h1> <p>There are a number of different ways of applying redirects on GOV.UK.
Here is a guide for choosing the right one:</p>

<ul>
  <li>Is the redirect a short URL, such as <code>gov.uk/dfe</code>?
<a href="#redirect-using-the-short-url-manager">Use Short URL Manager</a>.</li>
  <li>Are you redirecting a HMRC manual?
Read the <a href="#redirects-for-hmrc-manuals">HMRC section</a>.</li>
  <li>Are you redirecting from a campaign site?
Read the <a href="#redirects-from-campaign-sites">campaign sites section</a>.</li>
</ul>

<p>That covers the service-specific redirects. We then have several options
for applying redirects to most GOV.UK content:</p>

<ul>
  <li>Are you having an incident and need to apply a redirect <em>urgently</em>?
You can <a href="#manually-apply-a-redirect-in-router-api">apply the redirect directly in Router API</a>
(though you'll need to do some housekeeping afterwards).</li>
  <li>Is the redirect correctly showing in Content Store, but not in Router API?
You may just need to <a href="#manually-register-a-route-in-content-store">nudge Content Store into updating Router API</a>.</li>
  <li>Is the redirect correctly showing in Publishing API, but not in Content Store?
Try <a href="#manually-re-present-the-content-item-in-publishing-api">re-presenting the content item downstream</a>.</li>
  <li>Does the redirect not exist anywhere yet?
You'll need to <a href="#manually-apply-a-redirect-from-any-publishing-app">apply a redirect from within the relevant publishing app</a>.</li>
</ul>

<h2 id="manually-apply-a-redirect-from-any-publishing-app">Manually apply a redirect from any publishing app</h2>

<p>The preferred method of creating redirects is to use the publishing app that
originally published the content to set up the redirect. You can find out
<a href="#find-out-if-the-route-exists">what exists at the incoming URL already</a> (if
anything), and <a href="#find-out-which-app-owns-the-route">which app owns the route</a>.</p>

<p>Once you've established which app owns the route, you should see if it is
possible to set up the redirect from within the app UI itself. This usually
involves unpublishing the content, whereupon the app gives the option to
redirect the old route to another route. This approach is preferred as it
keeps the workflow and publishing history within the app, as well as
correctly propagating the changes through Publishing API, Content Store and
Router API.</p>

<p>Not all applications support unpublishing / setting redirects. In these
cases, you'll need to interact with Publishing API manually - see below.</p>

<blockquote>
  <p>Note that this won't work if the thing you're redirecting originates from
the Short URL Manager: there's <a href="#removing-a-route-created-in-the-short-url-manager">a rake task</a>
for that.</p>
</blockquote>

<p>You'll need to get the content ID of the current thing that exists at the
route you want to redirect from. This is generally just a case of visiting
the route prefixed with <code>/api/content</code> to expose its Content Store
information.</p>

<p>You may want to log into the Content Store app console in another shell:</p>

<p><code>$ gds govuk connect app-console -e production content_store/content-store</code></p>

<p>In the Content Store console, run
<code>content_item = ContentItem.find_by(content_id: "CONTENT_ID")</code> to get a
handle on the current state of the content item. If the content item
already has a <code>document_type</code> of <code>redirect</code> and the <code>redirects</code> property
has the <code>path</code> and <code>destination</code> properties you're aiming for, then all
you may need to do is
<a href="#manually-register-a-route-in-content-store">nudge Content Store into talking to Router API</a>.
If your content item doesn't have a redirect in Content Store, but you
know a redirect has been applied in Publishing API, you may need to
<a href="#manually-re-present-the-content-item-in-publishing-api">re-present the edition in Publishing API</a>.</p>

<p>Assuming the redirect doesn't exist yet, and you know no attempt has been
made to redirect the item in Publishing API, your next step is to open a
console on the publishing app in question. Then run this command:</p>

<div class="highlight"><pre class="highlight ruby"><code><span class="no">GdsApi</span><span class="p">.</span><span class="nf">publishing_api</span><span class="p">.</span><span class="nf">unpublish</span><span class="p">(</span>
  <span class="n">content_id</span><span class="p">,</span>
  <span class="ss">type: </span><span class="s2">"redirect"</span><span class="p">,</span>
  <span class="ss">explanation: </span><span class="s2">"manually redirected by YOUR_NAME"</span><span class="p">,</span>
  <span class="ss">alternative_path: </span><span class="s2">"/new-path"</span><span class="p">,</span>
  <span class="ss">discard_drafts: </span><span class="kp">true</span>
<span class="p">)</span>
</code></pre></div>
<p>You should see a 200 response:</p>

<div class="highlight"><pre class="highlight plaintext"><code>#&lt;GdsApi::Response:0x00007f81feba4c30 @http_response=&lt;RestClient::Response 200 "{\"content_i..."&gt;, @web_urls_relative_to=nil&gt;
</code></pre></div>
<p>And you will see that the content item in the Content Store
console has been updated, if you run <code>content_item.reload</code> in
your other console.</p>

<p>When Content Store is updated with a new route, it
<a href="https://github.com/alphagov/content-store/blob/dd79a03d74f130650bc97d1c84aae557ccea58d3/app/models/content_item.rb#L33">talks directly to Router API</a>.
You should now be redirected when you visit the route in your browser.</p>

<h3 id="manually-re-present-the-content-item-in-publishing-api">Manually re-present the content item in Publishing API</h3>

<p>Sometimes, Publishing API and Content Store can end up out of sync
with one another, whereby a redirect has been applied to a content
item in Publishing API but hasn't been successfully processed by
Content Store. In these cases, there are several
<a href="https://github.com/alphagov/publishing-api/blob/master/lib/tasks/represent_downstream.rake">rake tasks</a>
we can use to re-present the content item from Publishing API to
Content Store.</p>

<p>First, you'll need the content ID of the content item. Here we have
a Publishing API console and we've retrieved the Unpublishing record
(which has the redirect information) for the content item. We find
its associated content ID and can then use this in one of the linked
rake tasks.</p>

<div class="highlight"><pre class="highlight plaintext"><code>unpublishing = Unpublishing.find_by(alternative_path: "/foo")

unpublishing.edition.content_id
=&gt; "ddcab6e2-8985-4646-9f3d-82d2f4770186"
</code></pre></div>
<h3 id="manually-register-a-route-in-content-store">Manually register a route in Content Store</h3>

<p>Sometimes, our publishing platform prevents the creation of
new routes (and the addition/removal of redirects) while we
are scaling up certain parts of the stack.</p>

<p>If the content item in Content Store is showing the correct
route, but Router API is not, then re-publishing the item will
not work, as the route in Content Store will be unchanged.
Content Store only updates Router API
<a href="https://github.com/alphagov/content-store/blob/8651b9245046f0a0ae125dde018d39f8507226c5/app/models/content_item.rb#L224-L232">if it detects the route has changed</a>.</p>

<p>In such cases, you can get Content Store to register the route
again, by opening the Content Store console and running:</p>

<div class="highlight"><pre class="highlight ruby"><code><span class="no">ContentItem</span><span class="p">.</span><span class="nf">find_by</span><span class="p">(</span><span class="ss">base_path: </span><span class="s2">"/old-path-to-be-redirected"</span><span class="p">).</span><span class="nf">route_set</span><span class="p">.</span><span class="nf">register!</span>
</code></pre></div>
<h3 id="manually-apply-a-redirect-in-router-api">Manually apply a redirect in Router API</h3>

<p>You might need to urgently apply a redirect, and Publishing API
might have a large backlog of publishing in its downstream_high
queue, making the Publishing API approach too slow.</p>

<p>First, connect to the Router API console:</p>

<p><code>$ gds govuk connect -e production app-console router_backend/router-api</code></p>

<p>Then update the route directly:</p>

<div class="highlight"><pre class="highlight ruby"><code><span class="no">Route</span><span class="p">.</span><span class="nf">find_by</span><span class="p">(</span><span class="ss">incoming_path: </span><span class="s2">"..."</span><span class="p">).</span><span class="nf">update!</span><span class="p">(</span><span class="ss">redirect_to: </span><span class="s2">"..."</span><span class="p">,</span> <span class="ss">handler: </span><span class="s2">"redirect"</span><span class="p">,</span> <span class="ss">redirect_type: </span><span class="s2">"permanent"</span><span class="p">)</span>
</code></pre></div>
<p>You should always go back and fix things properly in Publishing
API afterwards, as a republish could easily undo any changes you've
made.</p>

<h2 id="find-out-if-the-route-exists">Find out if the route exists</h2>

<p>Open a router-api console:</p>

<div class="highlight"><pre class="highlight console"><code><span class="gp">$</span><span class="w"> </span>gds govuk connect app-console <span class="nt">-e</span> production router_backend/router-api
</code></pre></div>
<p>Then search for the incoming path you are interested in:</p>

<div class="highlight"><pre class="highlight console"><code><span class="gp">&gt;</span><span class="w"> </span>Route.where<span class="o">(</span>incoming_path: <span class="s1">'/path-to-item'</span><span class="o">)</span>
</code></pre></div>
<p>If a route is found, and it has the handler <code>redirect</code>, then there is
already a redirect in place.</p>

<h2 id="find-out-which-app-owns-the-route">Find out which app owns the route</h2>

<p>Open a Content Store console:</p>

<div class="highlight"><pre class="highlight console"><code><span class="gp">$</span><span class="w"> </span>gds govuk connect app-console <span class="nt">-e</span> production content_store/content-store
</code></pre></div>
<p>Then search for the incoming path you are interested in:</p>

<div class="highlight"><pre class="highlight console"><code><span class="go">ContentItem.find_by(base_path: "/path-to-item").publishing_app
</span></code></pre></div>
<h2 id="redirect-using-the-short-url-manager">Redirect using the Short URL Manager</h2>

<p>If the redirect is from a URL that is not a currently-published content item,
you should first look to use the <a href="https://short-url-manager.publishing.service.gov.uk">Short URL Manager</a> to
create a redirect request. Requests are checked and approved by content
designers, after which they are made live.</p>

<p>Redirects created in Short URL Manager are published via the Publishing API.</p>

<p>Specific Signon <a href="https://github.com/alphagov/short-url-manager/#permissions">permissions</a> are required to
make and approve redirect requests through the Short URL Manager. Additionally,
there is a <code>advanced_options</code> permission which enables creating redirects for
pages that are already owned by other apps, creating <code>prefix</code> type redirects,
and using non-default values for the <code>segments_mode</code>.</p>

<h3 id="removing-a-route-created-in-the-short-url-manager">Removing a route created in the Short URL Manager</h3>

<p>First find the <code>content_id</code> of the URL that needs to be removed. This can be found by using the Content Store API: <code>www.gov.uk/api/content/&lt;path goes here&gt;</code>.</p>

<p>For example, finding the <code>content_id</code> for the page about <a href="https://www.gov.uk/guidance/keeping-a-pet-pig-or-micropig">keeping a pet pig or micropig</a> is found by going to <a href="https://www.gov.uk/api/content/guidance/keeping-a-pet-pig-or-micropig"><code>www.gov.uk/api/content/guidance/keeping-a-pet-pig-or-micropig</code></a>. The <code>content_id</code> should be a UUID; for example: <code>602144f8-7631-11e4-a3cb-005056011aef</code>.</p>

<p>The content_id is with a rake task that removes the shortlink. The <a href="https://docs.publishing.service.gov.uk/apps/short-url-manager.html#run-a-rake-task">Short URL Manager documentation</a> has handy links for running the rake tasks in the different environments.</p>

<p>The rake task for removing a redirect is:</p>

<div class="highlight"><pre class="highlight plaintext"><code>redirect:destroy[&lt;UUID goes here&gt;]
</code></pre></div>
<ul>
  <li><a href="https://deploy.integration.publishing.service.gov.uk/job/run-rake-task/parambuild/?TARGET_APPLICATION=short-url-manager&amp;MACHINE_CLASS=backend&amp;RAKE_TASK=redirect:destroy[UUID goes here]">Run redirect:destroy[UUID goes here] on Integration</a></li>
<li><a href="https://deploy.blue.staging.govuk.digital/job/run-rake-task/parambuild/?TARGET_APPLICATION=short-url-manager&amp;MACHINE_CLASS=backend&amp;RAKE_TASK=redirect:destroy[UUID goes here]">Run redirect:destroy[UUID goes here] on Staging</a></li>
<li><a href="https://deploy.blue.production.govuk.digital/job/run-rake-task/parambuild/?TARGET_APPLICATION=short-url-manager&amp;MACHINE_CLASS=backend&amp;RAKE_TASK=redirect:destroy[UUID goes here]">⚠️ Run redirect:destroy[UUID goes here] on Production ⚠️</a></li>
</ul>

<p>For example:</p>

<div class="highlight"><pre class="highlight plaintext"><code>redirect:destroy["123e4567-e89b-12d3-a456-426614174000"]
</code></pre></div>
<p>The redirect is now removed and will return a <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/410">410 Gone status</a>.</p>

<h3 id="removing-a-route-completely-so-it-can-be-replaced-with-another-route">Removing a route completely so it can be replaced with another route</h3>

<p>Removing a route using the rake task in the previous section returns a 410 Gone status - this means that the URL can not be reused by another publication as the route is still being used.</p>

<p>To completely remove a route requires using the Rails console for several different apps using the <a href="https://docs.publishing.service.gov.uk/manual/get-started.html#3-install-gds-tooling">GDS CLI and GOV.UK Connect tools</a>.</p>

<p>To access an app's Rails console, the following command is used:</p>

<div class="highlight"><pre class="highlight shell"><code>gds govuk connect app-console <span class="nt">--environment</span> &lt;environment&gt; &lt;app name&gt;
</code></pre></div>
<p>Replace <code>&lt;environment&gt;</code> with <code>integration</code>, <code>staging</code>, or <code>production</code>; and <code>&lt;app name&gt;</code> with the name of the app you want to access.</p>

<p>For example, accessing the console for the <code>publishing-api</code> app in <code>staging</code> would be:</p>

<div class="highlight"><pre class="highlight shell"><code>gds govuk connect app-console <span class="nt">--environment</span> staging publishing-api
</code></pre></div>
<p>Removing the route, we need to know the slug that should be deleted. These examples use <code>/example-path</code>.</p>

<p>Delete the route in <code>router-api</code>:</p>

<div class="highlight"><pre class="highlight ruby"><code><span class="no">Route</span><span class="p">.</span><span class="nf">where</span><span class="p">(</span><span class="ss">incoming_path: </span><span class="s2">"/example-path"</span><span class="p">).</span><span class="nf">delete</span>
</code></pre></div>
<p>In <code>publishing-api</code>, delete the reservation that makes sure that the route can't be used by any other app:</p>

<div class="highlight"><pre class="highlight ruby"><code><span class="no">PathReservation</span><span class="p">.</span><span class="nf">find_by</span><span class="p">(</span><span class="ss">base_path: </span><span class="s2">"/example-path"</span><span class="p">).</span><span class="nf">delete</span>
</code></pre></div>
<p>In content-store <em>and</em> the content-store-draft, remove the content item that used in inhabit the URL:</p>

<div class="highlight"><pre class="highlight ruby"><code><span class="no">ContentItem</span><span class="p">.</span><span class="nf">find_by</span><span class="p">(</span><span class="ss">base_path: </span><span class="s2">"/example-path"</span><span class="p">).</span><span class="nf">delete</span>
</code></pre></div>
<p>For documents published in Mainstream Publisher, update and republish the content that should now sit at <code>/example-path</code>.</p>

<p>(In Mainstream Publisher the edition id can be found at the end of the URL. For example, the edition found at publisher.publishing.service.gov.uk/editions/<mark>5fb53d8fd3bf7f626687198c</mark> has the edition id <code>5fb53d8fd3bf7f626687198c</code>.)</p>

<div class="highlight"><pre class="highlight ruby"><code><span class="n">edition</span> <span class="o">=</span> <span class="no">Edition</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="s2">"&lt;edition id&gt;"</span><span class="p">)</span>

<span class="no">UpdateWorker</span><span class="p">.</span><span class="nf">perform_async</span><span class="p">(</span><span class="n">edition</span><span class="p">.</span><span class="nf">id</span><span class="p">.</span><span class="nf">to_s</span><span class="p">)</span>

<span class="no">RepublishWorker</span><span class="p">.</span><span class="nf">perform_async</span><span class="p">(</span><span class="n">edition</span><span class="p">.</span><span class="nf">id</span><span class="p">.</span><span class="nf">to_s</span><span class="p">)</span>
</code></pre></div>
<p>For documents published in other publishing apps that are not Mainstream Publisher, the instructions will differ.</p>

<p>The final step is to <a href="https://docs.publishing.service.gov.uk/manual/purge-cache.html">clear the cache for the routes</a>.</p>

<h2 id="fixing-incorrect-corporate-information-page-redirects">Fixing incorrect Corporate Information page redirects</h2>

<p>There have been a few occasions where Corporate Information pages have
started redirecting the English version to a translation. Should this
happen, the redirects can be identified with:</p>

<div class="highlight"><pre class="highlight ruby"><code><span class="no">Route</span><span class="p">.</span><span class="nf">where</span><span class="p">(</span><span class="ss">incoming_path: </span><span class="sr">/\/about/</span><span class="p">).</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">route</span><span class="o">|</span>
  <span class="nb">puts</span> <span class="s2">"</span><span class="si">#{</span><span class="n">route</span><span class="p">.</span><span class="nf">id</span><span class="si">}</span><span class="s2"> </span><span class="si">#{</span><span class="n">route</span><span class="p">.</span><span class="nf">incoming_path</span><span class="si">}</span><span class="s2"> -&gt; </span><span class="si">#{</span><span class="n">route</span><span class="p">.</span><span class="nf">redirect_to</span><span class="si">}</span><span class="s2">"</span> <span class="k">if</span> <span class="n">route</span><span class="p">.</span><span class="nf">handler</span> <span class="o">==</span> <span class="s2">"redirect"</span>
<span class="k">end</span>
</code></pre></div>
<p>That will list the id and paths for each redirect. Redirects from the
English version to a translation, for example:</p>

<div class="highlight"><pre class="highlight plaintext"><code>579a109cd068b406250014e4 /government/organisations/companies-house/about/access-and-opening -&gt; /government/organisations/companies-house/about/access-and-opening.cy
</code></pre></div>
<p>…can be deleted with</p>

<div class="highlight"><pre class="highlight ruby"><code><span class="no">Route</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="s1">'579a109cd068b406250014e4'</span><span class="p">).</span><span class="nf">destroy</span>
</code></pre></div>
<p>For the deleted routes to take effect, you need to reload the router.</p>

<div class="highlight"><pre class="highlight ruby"><code><span class="no">RouterReloader</span><span class="p">.</span><span class="nf">reload</span>
</code></pre></div>
<h2 id="redirects-for-hmrc-manuals">Redirects for HMRC manuals</h2>

<p>There are rake tasks for redirecting HMRC manuals and HMRC manual sections, which can be <a href="https://github.com/alphagov/hmrc-manuals-api/tree/master/lib/tasks">found in the hmrc-manuals-api repo</a>. These can be run via the <code>Run rake task</code> jenkins job.</p>

<p><a href="https://deploy.integration.publishing.service.gov.uk/job/run-rake-task/parambuild/?TARGET_APPLICATION=hmrc-manuals-api&amp;MACHINE_CLASS=backend&amp;RAKE_TASK=redirect_hmrc_section[original-parent-manual-slug,original-section-slug,new-parent-manual-slug,new-section-slug]">See example of redirecting a HMRC manual section to another section</a></p>

<h2 id="redirects-from-campaign-sites">Redirects from campaign sites</h2>

<p>The campaigns platform is a WordPress site managed by dxw. Redirects from a
<code>*.campaign.gov.uk</code> site require a support ticket. Currently, James Whitmarsh or
Kelvin Gan can raise a ticket.</p>


  <div class='related-content'>
    <h4>Related applications</h4>

    <ul class="govuk-list">
      <li><a href="/apps/short-url-manager.html">short-url-manager</a></li>
    </ul>

    <h3>More in the Routing section</h3>

    <div class='govuk-grid-row'>

        <div class='govuk-grid-column-one-half'>
          <h4>How to...</h4>

          <ul class="govuk-list">
            <li><a href="/manual/changing-organisation-slug.html">Change an organisation's slug</a></li>
            <li><a href="/manual/check-for-gone-route.html">Check for a 'gone' route</a></li>
            <li><a href="/manual/editing-an-existing-route.html">Edit an existing route in the Router</a></li>
          </ul>
        </div>

    </div>
</div>


            
          </main>

          <aside>
              <ul class="contribution-banner">
                <li><a href="https://github.com/alphagov/govuk-developer-docs/blob/master/source/manual/redirect-routes.html.md.erb">View source</a></li>
                <li><a href="https://github.com/alphagov/govuk-developer-docs/issues/new?labels=bug&amp;title=Re:%20'Redirect%20a%20route'&amp;body=Problem%20with%20'Redirect%20a%20route'%20(https://docs.publishing.service.gov.uk/manual/redirect-routes.html)">Report problem</a></li>
                <li><a href="https://github.com/alphagov/govuk-developer-docs">GitHub Repo</a></li>
              </ul>
          </aside>

          <footer class="govuk-footer app-footer" role="contentinfo">
  <div class="govuk-footer__meta">
    <div class="govuk-footer__meta-item govuk-footer__meta-item--grow">

        <ul class="govuk-footer__inline-list">
            <li class="govuk-footer__inline-list-item">
              <a class="govuk-footer__link" href="/accessibility.html">Accessibility</a>
            </li>
        </ul>

      <svg
        aria-hidden="true"
        focusable="false"
        class="govuk-footer__licence-logo"
        xmlns="http://www.w3.org/2000/svg"
        viewbox="0 0 483.2 195.7"
        height="17"
        width="41"
      >
        <path
          fill="currentColor"
          d="M421.5 142.8V.1l-50.7 32.3v161.1h112.4v-50.7zm-122.3-9.6A47.12 47.12 0 0 1 221 97.8c0-26 21.1-47.1 47.1-47.1 16.7 0 31.4 8.7 39.7 21.8l42.7-27.2A97.63 97.63 0 0 0 268.1 0c-36.5 0-68.3 20.1-85.1 49.7A98 98 0 0 0 97.8 0C43.9 0 0 43.9 0 97.8s43.9 97.8 97.8 97.8c36.5 0 68.3-20.1 85.1-49.7a97.76 97.76 0 0 0 149.6 25.4l19.4 22.2h3v-87.8h-80l24.3 27.5zM97.8 145c-26 0-47.1-21.1-47.1-47.1s21.1-47.1 47.1-47.1 47.2 21 47.2 47S123.8 145 97.8 145"
        />
      </svg>
      <span class="govuk-footer__licence-description">
        All content is available under the
        <a
          class="govuk-footer__link"
          href="https://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/"
          rel="license"
        >Open Government Licence v3.0</a>, except where otherwise stated
      </span>
    </div>
    <div class="govuk-footer__meta-item">
      <a
        class="govuk-footer__link govuk-footer__copyright-logo"
        href="https://www.nationalarchives.gov.uk/information-management/re-using-public-sector-information/uk-government-licensing-framework/crown-copyright/"
      >© Crown copyright</a>
    </div>
  </div>
</footer>

        </div>
      </div>
    </div>

    
    <script src="/javascripts/application.js"></script>
  </body>
</html>
